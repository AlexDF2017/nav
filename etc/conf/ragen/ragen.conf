# oversatt til v3 av vf 18.12.02

# fil: ragen.conf
# 
# Konfigurasjonsfil for rapportgeneratoren
#
# Navn på sikre rapporter (for internbrukere) må avslutte med _sec eks: netbox_sec
# variabler starter med '$', og kommentarer med '#'
# verdier må være innelukket i doble anførselstegn ("), og linjer må slutte med semikolon (;)
# $sql er sql-spørrelinja mot databasen
# $order_by er en etkstra måte å spesifisere sortering fra, brukes fra en lenke
# $overskrift er tabellens overskrift på websiden
# $ekstra er ekstra kolonner man vil sette inn for å lage ekstra lenker
# $skjul er kolonner som skal skjules fra visningen av resultatet
# $sum angir kolonner som skal summeres
# $count angir kolonner som skal telles
# $navn_MYCOL endrer en kolonneoverskrift
# $url_MYCOL tilordner en lenke til tabellruteinnholdet til en kolonne
# $forklar_MYCOL legger til en tekstlig forklaring i toppen av tabellen (fint for små kolonneoverskrifter, som ekstra-feltene)
#
# ---------------------------------------------------------------------
# netbox-relaterte rapporter
#
netbox {
$sql="SELECT roomid,sysname,host(ip),catid,subcat,typeid,typename,orgid,
count(moduleid) AS antmod,netboxid,prefixid FROM type RIGHT OUTER JOIN 
netbox USING (typeid) LEFT JOIN module USING (netboxid)
GROUP by netboxid,prefixid,sysname,host(ip),catid,
         subcat,typeid,typename,roomid,orgid";
$overskrift = "Utstyrsregister";
$order_by="roomid";
$navn_sysname="Navn";
$navn_catid="Kat";
$navn_subcat="Underkat";
$navn_host(ip)="IP-adresse";
$skjul = "netboxid,prefixid,typeid";
$navn_typename="Type";
$navn_roomid="Rom";
$navn_orgid="Drifter";
$ekstra="mem,swp,gwp,kart";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_host(ip)="?rapport=prefix&prefixid=$prefixid";
$url_catid="?rapport=netbox&catid=$catid";
$url_antmod="?rapport=modules&sysname=$sysname";
$url_mem="?rapport=mem&sysname=$sysname";
$url_swp="?rapport=swport&netboxid=$netboxid";
$url_gwp="?rapport=gwport&netboxid=$netboxid";
$url_kart="/vlanPlot/?netboxid=$netboxid";
$forklar_mem="Minne";
$forklar_swp="Svitsjeporter (om aktuelt)";
$forklar_gwp="Ruterporter (om aktuelt)";
}

# kuttet main_sw og serial
gw {
$sql="SELECT roomid,sysname,typeid,typename,orgid,netboxid FROM 
type RIGHT OUTER JOIN netbox USING (typeid) 
WHERE (catid='GW' OR catid='GSW')";
$overskrift = "Rutere";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typename="Type";
$navn_roomid="Rom";
$order_by="roomid";
$ekstra="gwp,mod,mem";
$skjul = "netboxid,typeid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_gwp="?rapport=gwport&netboxid=$netboxid";
$url_mem="?rapport=mem&sysname=$sysname";
$url_mod="?rapport=modules&sysname=$sysname";
$forklar_gwp="Ruterporter";
$forklar_mod="Moduler";
$forklar_mem="Minne";
}

# tatt ut main_sw og serial
sw {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,netboxid 
FROM type RIGHT OUTER JOIN netbox USING (typeid) 
WHERE (catid='SW' OR catid='GSW')";
$overskrift = "Svitsjer";
$navn_sysname="Navn";
$navn_host(ip)="IP-adresse";
$navn_orgid="Drifter";
$navn_typename="Type";
$navn_roomid="Rom";
$order_by="roomid";
$ekstra="moduler,minne,swport";
$skjul = "netboxid,typeid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_swport="?rapport=swport&netboxid=$netboxid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

#$sql="SELECT usageid,count(prefixid) AS antallnett,descr
#FROM usage LEFT JOIN prefix USING (usageid) GROUP BY usageid,descr";    

srv {
$sql="SELECT 
roomid,sysname,host(ip),catid,subcat,orgid,count(serviceid) as AntTjenMon,
netboxid,prefixid 
FROM netbox LEFT JOIN service USING (netboxid) WHERE catid='SRV'
GROUP BY roomid,sysname,host(ip),catid,subcat,orgid,netboxid,prefixid";
$overskrift = "Servere";
$navn_sysname="Navn";
$navn_host(ip)="IP";
$navn_orgid="Drifter";
$navn_roomid="Rom";
$order_by="roomid";
$skjul = "netboxid,prefixid";          
$url_host(ip)="?rapport=prefix&prefixid=$prefixid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_AntTjenMon="?rapport=servicemon&netboxid=$netboxid";
}

servicemon {
$sql="SELECT sysname,handler,version,netboxid FROM service LEFT JOIN netbox 
USING 
(netboxid)";
$overskrift="Tjenester som overvåkes";
$navn_orgid="Drifter";
$skjul="netboxid";
$url_sysname="?rapport=srv&sysname=$sysname";
}
 
# wlan - traadloese saker 
wlan{ 
$sql="select 
roomid,sysname,host(ip),catid,subcat,descr,prefixid from
netbox left join type using (typeid) 
where catid='WLAN'"; $order_by="host(ip)"; 
$skjul="prefixid"; 
$overskrift="Trådløs nettel"; 
$url_roomid="?rapport=room&roomid=$roomid"; 
$url_host(ip)="?rapport=prefix&prefixid=$prefixid"; 
} 

oppsop { $sql="SELECT 
roomid,sysname,host(ip),catid,subcat,orgid,netboxid FROM netbox WHERE catid='NAS' OR catid='REST'";
$overskrift = "Oppsop";
$order_by="roomid";
$skjul = "netboxid";
$url_roomid="?rapport=room&roomid=$roomid";
#$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}


kant {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,
count(moduleid),netboxid,prefixid FROM type 
RIGHT OUTER JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid)
WHERE catid='KANT'
GROUP by netboxid,prefixid,sysname,host(ip),typeid,typename,roomid,orgid";
$overskrift = "Kantutstyr";
$order_by="roomid";
$ekstra="moduler";
$skjul = "netboxid,prefixid,typeid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_host(ip)="?rapport=prefix&prefixid=$prefixid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_count(moduleid)="?rapport=modules&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
$navn_count(moduleid) = "Antall moduler";
$navn_typename="Type";
$navn_host(ip)="IP";
#$count = "moduleid";
#$sum="count(moduleid)";
}

kanttmp {
$sql="SELECT sysname,host(ip),modulenumber FROM netbox JOIN module using (netboxid)
GROUP by sysname,host(ip)";
$overskrift = "PS40";
$order_by="host(ip)";
}

# Denne kommer inn når netboxinfo kommer
#$sql="SELECT roomid,sysname,typeid,orgid,software FROM netbox,netboxinfo where 
#catid='GW' AND netbox.netboxid=netboxinfo.netboxid";

modulecat {
$sql="SELECT typename,sysName,modulenumber,model,sw,hw 
FROM netbox JOIN module USING (netboxid) LEFT OUTER JOIN type USING (typeid) 
WHERE typegroupid='cat-sw' order by
sysName,modulenumber";
$navn_typename = "Type";
$overskrift = "Catalyster";
$order_by="sysname";
}

modultype {
$sql="SELECT model,descr,count(model) AS antall FROM module 
GROUP BY model,descr";
$overskrift=Modultyper";
$url_antall="?rapport=modules&model=$model";
}

modules {
$sql="SELECT 
roomid,sysname,typeid,typename,catid,modulenumber AS mn,
model,module.descr,sw,hw,serial,ports,portsup 
FROM type RIGHT OUTER JOIN netbox USING (typeid) JOIN module 
USING (netboxid)";
$overskrift = "Moduler";
$order_by="roomid,sysname,modulenumber";
$skjul = "typeid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_typename="?rapport=type&typeid=$typeid";
$url_mn="?rapport=swport&sysname=$sysname&modul=$mn";
$forklar_mn="Modulnummer";
}

mem {
$sql="SELECT sysname,catid,typename,memtype,device,size,used FROM netbox 
JOIN mem USING (netboxid) LEFT JOIN type USING (typeid)";
$order_by="sysname,catid,memtype,device";
$overskrift = "Minne";
$navn_(size/1024/1024)="Size";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_memtype="?rapport=mem&memtype=$memtype";
$url_device="?rapport=mem&device=$device";
$url_typename="?rapport=type&typename=$typename";
}

# ---------------------------------------------------------------------
# ruterport/prefix-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interface,speed,host(gwip),masklen(netaddr),vlan,nettype,
netident,ospf,gwport.prefixid,netboxid,active_ip_cnt 
FROM gwport LEFT JOIN prefix USING (prefixid) JOIN netbox USING (netboxid)";
$overskrift = "Ruterporter";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "netboxid,prefixid";
//nye navn
$navn_sysname="Ruter";
$navn_interface="Ruterport";
$navn_host(gwip)="IP-adresse";
$navn_speed="Mbps";
$navn_masklen(netaddr)="M";
$navn_ospf="O";
$navn_active_ip_cnt="Ant";
$navn_prefixid="p";
$order_by="sysname,interface";
$url_host(gwip)="?rapport=prefix&prefixid=$prefixid";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
$forklar_m="Subnettmaske";
$forklar_o="OSPF kostnad";
$forklar_ant="Antall maskiner";
$sum="active_ip_cnt";
}

# 
prefix {
$sql="SELECT 
host(netaddr),masklen(netaddr),vlan,nettype,netident,prefix.orgid,usageid,
active_ip_cnt,count(distinct gwportid) as antgw,
count(distinct netbox.netboxid) as antnetbox, prefixid FROM prefix 
LEFT JOIN gwport USING (prefixid) LEFT JOIN netbox USING (prefixid)
GROUP BY 
netaddr,vlan,nettype,netident,prefix.orgid,usageid,active_ip_cnt,prefixid"; 
$overskrift = "Subnett i bruk";
$order_by="netaddr";
$navn_host(netaddr) = "Nettadresse";
$navn_active_ip_cnt="Ant";
$navn_masklen(netaddr)="M";
$skjul = "prefixid";
$url_antgw="?rapport=gwport&prefixid=$prefixid";
$url_antnetbox="?rapport=netbox&prefixid=$prefixid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_usageid="?rapport=usage&usageid=$usageid";
$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
$forklar_m="Subnettmaske";
$forklar_komm="Kommentar";
$forklar_ant="Antall maskiner";
$forklar_antgw="Antall rutere tilkoblet";
$forklar_antnetbox="Nettel/servere tilkoblet";
$sum="active_ip_cnt";
}

# prefix rapport som også viser rutere
prefixmgw {
$sql="SELECT sysname,host(netaddr),masklen(netaddr),vlan,nettype,netident,prefix.orgid,usageid,active_ip_cnt,prefix.prefixid FROM 
prefix,gwport,netbox WHERE gwport.prefixid=prefix.prefixid AND gwport.netboxid=netbox.netboxid";
$overskrift = "Subnett i bruk med tilkoblede rutere";
$order_by="netaddr";
$navn_host(netaddr) = "Nettadresse";
$navn_masklen(netaddr)="M";
$navn_netaddr = "Nettadresse";
$navn_sysname = "Ruter";
$skjul = "prefixid";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_host(netaddr)="?rapport=gwport&prefixid=$prefixid";
$url_masklen(netaddr)="?rapport=netbox&prefixid=$prefixid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_usageid="?rapport=usage&usageid=$usageid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også to_netboxid
swport {
$sql="SELECT b1.sysname,modul,port,link,speed,duplex,media,trunk,vlan,b2.sysname as to_netboxid,
portname, swport.swportid,swport.netboxid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)";
$overskrift = "Svitsjeporter";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="netboxid,modul,port";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_netboxid="?rapport=netbox&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefix&vlan=$vlan";
$url_to_netboxid="?rapport=netbox&sysname=$to_netboxid";
}
#$ekstra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port&up=$modul%3A$port";


# Denne viser flere rader ved trunk, en rad for hvert vlan
ikke vlan her.
swportv {
$sql="SELECT b1.sysname,modul,port,link,speed,duplex,media,trunk,vlan,b2.sysname as to_netboxid,
portname,swportid,swport.netboxid FROM swport JOIN swportvlan USING (swportid) 
JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)  
WHERE b1.catid like '%SW'
ORDER BY b1.netboxid,modul,port";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="b1.netboxid,modul,port";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_netboxid="?rapport=netbox&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefix&vlan=$vlan";
$url_to_netboxid="?rapport=netbox&sysname=$to_netboxid";
}

# topowalk

topowalk{
$sql="SELECT b1.sysname,s1.modul,s1.port,b2.sysname as to_netboxid,s2.modul,s2.port FROM
swport AS s1 JOIN netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)
LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid)";
$order_by="b1.sysname,s1.modul,s1.port";
$overskrift = "Svitsje topologivisning";
$ekstra="swbak,gwbak";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_to_netboxid="?rapport=netbox&sysname=$to_netboxid";
$url_gwbak="?rapport=topowalkgw&sysname=$to_netboxid";
$url_swbak="?rapport=topowalk&sysname=$to_netboxid";
}

topowalkgw{
$sql="SELECT b1.sysname,interface,b2.sysname as to_netboxid,s2.modul,s2.port FROM gwport
JOIN netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid)
LEFT JOIN swport AS s2 ON (gwport.to_swportid=s2.swportid)";
$overskrift = "Ruter topologivisning";
$order_by="b1.sysname,interface";
$ekstra="swbak,gwbak";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_to_netboxid="?rapport=netbox&sysname=$to_netboxid";
$url_gwbak="?rapport=topowalkgw&sysname=$to_netboxid";
$url_swbak="?rapport=topowalk&sysname=$to_netboxid";
}


# Denne viser kun trunkporter. Vi viser også to_netboxid
swportt {
$sql="SELECT b1.sysname,modul,port,link,speed,duplex,trunk,vlan,b2.sysname as to_netboxid,
portname, swport.swportid,swport.netboxid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) WHERE trunk='t'";
$overskrift = "Svitsjeporter";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
#$order_by="netboxid,modul,port";
$url_sysname="?rapport=netbox&sysname=$sysname";
$url_netboxid="?rapport=netbox&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefix&vlan=$vlan";
$url_to_netboxid="?rapport=netbox&sysname=$to_netboxid";
}

# ---------------------------------------------------------------------
# room,sted,type
#

room {
$sql="SELECT roomid,count(netboxid) AS antbokser,locationid,descr FROM room
LEFT JOIN netbox USING (roomid) GROUP BY roomid,locationid,descr";
$overskrift = "Telematikkrom";
$navn_roomid="rom";
$navn_locationid="sted";
$navn_descr="Beskrivelse";
$forklar_antnetbox="Antall registrerte enheter i rommet.";
$order_by="roomid";
$url_antbokser="?rapport=netbox&roomid=$roomid";
$url_locationid="?rapport=location&locationid=$locationid";
$sum="antbokser";
}

location {
$sql="SELECT locationid,count(roomid) AS antallrom,location.descr
FROM location LEFT JOIN room USING (locationid) GROUP BY locationid,location.descr";
$overskrift = "Område";
$order_by="locationid";
$navn_locationid="sted";
$navn_descr="Beskrivelse";
$url_antallrom="?rapport=room&locationid=$locationid";
}

type {
$sql="SELECT typename,count(distinct netboxid) AS antip,count(moduleid) AS antmod, 
vendorid,typeid,typegroupid,type.descr
FROM type JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid)
GROUP by typename,typeid,vendorid,typegroupid,type.descr";         
$overskrift = "Utstyrstyper";
$navn_typename="Type";
$navn_vendorid="Fabrikat";
$navn_typegroupid="Typegruppe";
$navn_descr="Beskrivelse";
$order_by="typename";
$skjul = "typeid";
$url_antip="?rapport=netbox&typeid=$typeid";     
$url_antmod="?rapport=modules&typeid=$typeid";     
$url_typegroupid="?rapport=typegroupid&typegroupid=$typegroupid";
$forklar_antip="Antall enheter av typen med IP-adresse";
$forklar_antmod="Antall moduler relatert til typen";
}
typegroupid {
$sql="SELECT typegroupid,descr FROM typegroup";
$overskrift = "Typegrupper";
$navn_typegroupid="Typegroupid";
$navn_descr="Beskrivelse";
$order_by="typegroupid";
}

# ---------------------------------------------------------------------
# usage,org
#
usage {
$sql="SELECT usageid,count(prefixid) AS antallnett,descr
FROM usage LEFT JOIN prefix USING (usageid) GROUP BY usageid,descr";    
$overskrift = "Anvendelsestype ";
$navn_usageid="Anvendelse"; 
$navn_descr="Beskrivelse";
$order_by="usageid";
$url_antallnett="?rapport=prefix&usageid=$usageid";
}
org {
$sql="SELECT orgid,count(prefixid) AS antallnett,parent,descr
FROM org LEFT JOIN prefix USING (orgid) GROUP BY orgid,parent,descr";
$overskrift = "Organisasjon";
$navn_descr="Beskrivelse";
$navn_parent="Mor";
$navn_orgid="Enhet";
$order_by="orgid";
$url_forelder="?rapport=org&orgid=$parent";
$url_antallnett="?rapport=prefix&orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,masklen(netaddr),host(ip),sysname FROM netbox JOIN prefix USING 
(prefixid) WHERE (catid='KANT' OR catid='SW') ORDER BY masklen(netaddr),vlan,host(ip)";
$overskrift = Switches/hubs sorted by mask size";
$navn_masklen(netaddr) = "Maske";
}
antkant {
$sql = "select masklen(netaddr),count(vlan),vlan from netbox join prefix using 
(prefixid) where (catid='KANT' OR catid='SW') 
group by vlan,masklen(netaddr) order by masklen(netaddr),count(vlan) desc";
$overskrift = "No of SW and KANT on each vlan";
$navn_masklen(netaddr) = "Maske";
$navn_count(vlan) = "Antall";
}

#
# EOF
#
