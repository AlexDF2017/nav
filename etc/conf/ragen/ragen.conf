#
# fil: ragen.conf
# 
# Konfigurasjonsfil for rapportgeneratoren
#
# Navn på sikre rapporter (for internbrukere) må avslutte med _sec eks: boks_sec
# variabler starter med '$', og kommentarer med '#'
# verdier må være innelukket i doble anførselstegn ("), og linjer må slutte med semikolon (;)
# $sql er sql-spørrelinja mot databasen
# $order_by er en etkstra måte å spesifisere sortering fra, brukes fra en lenke
# $overskrift er tabellens overskrift på websiden
# $ekstra er ekstra kolonner man vil sette inn for å lage ekstra lenker
# $skjul er kolonner som skal skjules fra visningen av resultatet
# $sum angir kolonner som skal summeres
# $count angir kolonner som skal telles
# $navn_MYCOL endrer en kolonneoverskrift
# $url_MYCOL tilordner en lenke til tabellruteinnholdet til en kolonne
# $forklar_MYCOL legger til en tekstlig forklaring i toppen av tabellen (fint for små kolonneoverskrifter, som ekstra-feltene)
#
# ---------------------------------------------------------------------
# boks-relaterte rapporter
#
boks {
$sql="SELECT romid,sysname,ip,kat,kat2,typeid,orgid,boksid,prefiksid
FROM boks";
$overskrift = "Utstyrsregister ";
$order_by="romid";
$navn_sysname="Navn";
$navn_ip="IP-adresse";
$skjul = "boksid,prefiksid";
$navn_typeid="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$ekstra="mod,mem,swp,kart";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_kat="?rapport=boks2&kat=$kat";
$url_mem="?rapport=mem&sysname=$sysname";
$url_mod="?rapport=modules&sysname=$sysname";
$url_swp="?rapport=swport&boksid=$boksid";
$url_kart="/vlanPlot/?boksid=$boksid";
$forklar_mod="Moduler";
$forklar_mem="Minne";
$forklar_swp="Svitsjeporter i db";
}

service {
$sql="SELECT romid,sysname,ip,typeid,orgid,watch,boksid,prefiksid
FROM boks WHERE active='N'";
$overskrift = "Enheter på service ";
$order_by="romid";
$navn_sysname="Navn";
$navn_ip="IP-adresse";
$skjul = "boksid,prefiksid";
$navn_typeid="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$navn_watch="Nede?";
$url_romid="?rapport=rom&romid=$romid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
}


boks2 {
$sql="SELECT romid,sysname,ip,kat,kat2,typeid,orgid,
count(moduleid),boksid,prefiksid FROM boks JOIN module USING (boksid)
GROUP by boksid,prefiksid,sysname,ip,kat,kat2,typeid,romid,orgid";
$overskrift = "Utstyrsregister med mer info ";
$order_by="romid";
$navn_sysname="Navn";
$navn_ip="IP-adresse";
$skjul = "boksid,prefiksid";
$navn_typeid="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$ekstra="moduler,minne";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

gw {
$sql="SELECT romid,sysname,typeid,orgid,main_sw,serial,boksid FROM 
boks LEFT JOIN boksinfo USING (boksid) WHERE kat='GW'";
$overskrift = "Rutere";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typeid="Type";
$navn_romid="Rom";
$order_by="romid";
$ekstra="gwp,mod,mem";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_gwp="?rapport=gwport&boksid=$boksid";
$url_mem="?rapport=mem&sysname=$sysname";
$url_mod="?rapport=modules&sysname=$sysname";
$forklar_gwp="Ruterporter";
$forklar_mod="Moduler";
$forklar_mem="Minne";
}

sw {
$sql="SELECT romid,sysname,ip,typeid,orgid,main_sw,serial,boksid FROM boks 
LEFT JOIN boksinfo USING (boksid) WHERE kat='SW'";
$overskrift = "Svitsjer";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typeid="Type";
$navn_romid="Rom";
$order_by="romid";
$ekstra="moduler,minne,swport";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_swport="?rapport=swport&boksid=$boksid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

srv {
$sql="SELECT romid,sysname,ip,kat,kat2,orgid,function,boksid,prefiksid 
FROM boks 
LEFT JOIN boksinfo USING (boksid) WHERE kat='SRV'";
$overskrift = "Servere";
$navn_sysname="Navn";
$navn_orgid="Drifter";
$navn_romid="Rom";
$order_by="romid";
$skjul = "boksid,prefiksid";          
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}

# Denne virker ikke dan vi ikke klarer AND pr dato.
#$sql="SELECT romid,sysname,ip,kat,kat2,orgid,boksid FROM boks 
#WHERE kat<>'SRV' AND kat<>'GW' AND kat<>'SRV' AND kat<>'kant'";

oppsop {
$sql="SELECT romid,sysname,ip,kat,kat2,orgid,boksid FROM boks 
WHERE kat='TS'";
$overskrift = "Oppsop";
$order_by="romid";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}


kant {
$sql="SELECT romid,sysname,ip,typeid,orgid,
count(moduleid),boksid,prefiksid FROM boks JOIN module USING (boksid)
WHERE kat='KANT'
GROUP by boksid,prefiksid,sysname,ip,typeid,romid,orgid";
$overskrift = "Kantutstyr";
$order_by="romid";
$ekstra="moduler";
$skjul = "boksid,prefiksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_count(moduleid)="?rapport=modules&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
$navn_count(moduleid) = "Antall moduler";
#$count = "moduleid";
#$sum="count(moduleid)";
}

kanttmp {
$sql="SELECT sysname,ip,modulenumber FROM boks JOIN module using (boksid)
GROUP by sysname,ip";
$overskrift = "PS40";
$order_by="ip";
}

# Denne kommer inn når boksinfo kommer
#$sql="SELECT romid,sysname,typeid,orgid,software FROM boks,boksinfo where 
#kat='GW' AND boks.boksid=boksinfo.boksid";

modulecat {
$sql="SELECT typeid,sysName,modulenumber,model,sw,hw FROM boks JOIN module USING
(boksid) JOIN type USING (typeid) where typegruppe='cat-sw' order by
sysName,modulenumber";
$overskrift = "Catalyster";
$order_by="sysname";
}
modules {
$sql="SELECT 
romid,sysname,typeid,kat,modulenumber,model,descr,sw,hw,serial,ports,portsup 
FROM boks JOIN module 
USING (boksid)";
$overskrift = "Moduler";
$order_by="romid,sysname,modulenumber";
$url_romid="?rapport=rom&romid=$romid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_typeid="?rapport=type&typeid=$typeid";
$url_modulenumber="?rapport=swport&sysname=$sysname&module=$modulenumber";
}

mem {
$sql="SELECT sysname,kat,typeid,memtype,device,size,used FROM boks JOIN mem USING 
(boksid)";
$order_by="sysname,kat,memtype,device";
$overskrift = "Minne";
$navn_(size/1024/1024)="Size";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_memtype="?rapport=mem&memtype=$memtype";
$url_device="?rapport=mem&device=$device";
}

# ---------------------------------------------------------------------
# ruterport/prefiks-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interf,speed,gwip,maske,vlan,nettype,nettident,ospf,
gwport.prefiksid,boksid,antmask 
FROM gwport LEFT JOIN prefiks USING (prefiksid) JOIN boks USING (boksid)";
$overskrift = "Ruterporter";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "boksid,prefiksid";
//nye navn
$navn_sysname="Ruter";
$navn_interf="Ruterport";
$navn_gwip="IP-adresse";
$navn_speed="Mbps";
$navn_maske="M";
$navn_ospf="O";
$navn_antmask="Ant";
$navn_prefiksid="p";
$order_by="sysname,interf";
$url_gwip="?rapport=prefiks&prefiksid=$prefiksid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_antmask="/res/arp/arp_sok.php?prefiksid=$prefiksid&dns=on";
$forklar_m="Subnettmaske";
$forklar_o="OSPF kostnad";
$forklar_ant="Antall maskiner";
$sum="antmask";
}

# 
prefiks {
$sql="SELECT 
nettadr,maske,vlan,nettype,nettident,orgid,anvid,komm,antmask,prefiksid 
FROM prefiks"; $overskrift = "Subnett i bruk";
$order_by="nettadr";
$navn_nettadr = "Nettadresse";
$navn_antmask="Ant";
$navn_maske="M";
$skjul = "prefiksid";
$ekstra="gw,boks";
$url_gw="?rapport=gwport&prefiksid=$prefiksid";
$url_boks="?rapport=boks&prefiksid=$prefiksid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_anvid="?rapport=anv&anvid=$anvid";
$url_antmask="/res/arp/arp_sok.php?prefiksid=$prefiksid&dns=on";
$forklar_m="Subnettmaske";
$forklar_komm="Kommentar";
$forklar_ant="Antall maskiner";
$forklar_gw="Rutere tilkoblet";
$forklar_ant="Nettel/servere tilkoblet";
$sum="antmask";
}

# prefiks rapport som også viser rutere
prefiksmgw {
$sql="SELECT sysname,nettadr,maske,vlan,nettype,nettident,prefiks.orgid,anvid,antmask,prefiks.prefiksid FROM 
prefiks,gwport,boks WHERE gwport.prefiksid=prefiks.prefiksid AND gwport.boksid=boks.boksid";
$overskrift = "Subnett i bruk med tilkoblede rutere";
$order_by="nettadr";
$navn_nettadr = "Nettadresse";
$navn_sysname = "Ruter";
$skjul = "prefiksid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_nettadr="?rapport=gwport&prefiksid=$prefiksid";
$url_maske="?rapport=boks&prefiksid=$prefiksid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_anvid="?rapport=anv&anvid=$anvid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også boksbak
swport {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,media,trunk,vlan,b2.sysname as boksbak,
portnavn, swport.swportid,swport.boksid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN boks AS b1 USING (boksid) LEFT JOIN boks AS b2 ON (boksbak=b2.boksid)";
$overskrift = "Svitsjeporter";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}
#$ekstra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port&up=$modul%3A$port";



# Denne viser flere rader ved trunk, en rad for hvert vlan
ikke vlan her.
swportv {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,media,trunk,vlan,b2.sysname as boksbak,
portnavn,swportid,swport.boksid FROM swport JOIN swportvlan USING (swportid) 
JOIN boks AS b1 USING (boksid) LEFT JOIN boks AS b2 ON (boksbak=b2.boksid)  
ORDER BY b1.boksid,modul,port";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="b1.boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}

# Disse brukes ikke 

swportvgammel {
$sql="SELECT sysname,modul,port,status,speed,duplex,trunk,vlan,
portnavn, swportid,swport.boksid FROM swport 
LEFT JOIN swportvlan USING (swportid) 
JOIN boks USING (boksid)";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
}


swportvlan{
$sql="SELECT swportid,vlan,retning FROM swportvlan";
$overskrift="Vlandefinisjoner";
$order_by="swportid";
}
swporttold {
$sql="SELECT 
sysname,modul,port,status,speed,duplex,trunk,portnavn,swportid,boksid
FROM swport JOIN boks USING (boksid) WHERE trunk='t'";
$overskrift = "Trunker";
$skjul="swportid,boksid";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
}

# Denne viser kun trunkporter. Vi viser også boksbak
swportt {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,trunk,vlan,b2.sysname as boksbak,
portnavn, swport.swportid,swport.boksid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN boks AS b1 USING (boksid) LEFT JOIN boks AS b2 ON (boksbak=b2.boksid) WHERE trunk='t'";
$overskrift = "Svitsjeporter";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
#$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}

# ---------------------------------------------------------------------
# rom,sted,type
#

rom {
$sql="SELECT romid,stedid,descr FROM rom";
$overskrift = "Telematikkrom";
$order_by="romid";
$url_romid="?rapport=boks&romid=$romid";
$url_stedid="?rapport=sted&stedid=$stedid";
}

sted {
$sql="SELECT stedid,descr FROM sted";
$overskrift = "Område";
$order_by="stedid";
$navn_descr="Beskrivelse";
$url_stedid="?rapport=rom&stedid=$stedid";
}
type {
$sql="SELECT typeid,descr FROM type";
$overskrift = "Utstyrstyper ";
$navn_typeid="Type";
$navn_descr="Beskrivelse";
$order_by="typeid";
$url_typeid="?rapport=boks&typeid=$typeid";
}

# ---------------------------------------------------------------------
# anv,org
#
anv {
$sql="SELECT anvid,descr FROM anv";
$overskrift = "Anvendelsestype ";
$navn_anvid="Anvendelse";
$navn_descr="Beskrivelse";
$order_by="anvid";
$url_anvid="?rapport=prefiks&anvid=$anvid";
}
org {
$sql="SELECT orgid,forelder,descr FROM org";
$overskrift = "Organisasjon";
$navn_descr="Beskrivelse";
$navn_forelder="Mor";
$navn_orgid="Enhet";
$order_by="orgid";
$url_forelder="?rapport=org&orgid=$forelder";
$url_orgid="?rapport=prefiks&orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,maske,ip,sysname FROM boks JOIN prefiks USING 
(prefiksid) WHERE (kat='KANT' OR kat='SW') ORDER BY maske,vlan,ip";
$overskrift = Switches/hubs sorted by mask size";
}
antkant {
$sql = "select maske,count(vlan),vlan from boks join prefiks using 
(prefiksid) where (kat='KANT' OR kat='SW') 
group by vlan,maske order by maske,count(vlan) desc";
$overskrift = "Number of *-sw/*-h on uach vlan";
}

#
# EOF
#
