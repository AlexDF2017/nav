##
## Top-level Makefile for NAV
##
SHELL = @SHELL@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@

INSTALL = @INSTALL@
nav_user = @nav_user@
top_srcdir = @top_srcdir@

NAME=nav
VERSION=$(shell cat VERSION)
PACKAGE=$(NAME)-$(VERSION)

subdirs = src \
	subsystem/lib-perl \
	subsystem/lib-python \
	subsystem/alertEngine \
	subsystem/alertprofiles \
	subsystem/backup \
	subsystem/devBrowser \
	subsystem/deviceManagement \
	subsystem/editdb \
	subsystem/eMotd \
	subsystem/machinetracker \
	subsystem/report \
	subsystem/smsd \
	subsystem/startstop \
	subsystem/statemon \
	subsystem/statTools \
	subsystem/status \
	subsystem/thresholdMon \
	subsystem/webFront

# Make sure we export make variables to the environment
export
.PHONY: all install clean distclean

all:
	@for dir in ${subdirs}; do \
	  $(MAKE) -C $$dir $@ || exit 1; \
	done
	@echo Done

install:
	@for dir in ${subdirs}; do \
	  $(MAKE) -C $$dir $@ || exit 1; \
	done
	@echo Done

clean:
	rm -f *~ 
	@for dir in ${subdirs}; do \
	  $(MAKE) -C $$dir $@ || exit 1; \
	done

distclean: clean
	rm -f config.status config.cache config.log Makefile
	@for dir in ${subdirs}; do \
	  $(MAKE) -C $$dir $@ || exit 1; \
	done

dist: distclean
	@echo Creating source tarball...
	@SRCDIR=`pwd`;                                  \
	TARBALL=$(PACKAGE).tar.gz;                      \
	/bin/rm -f /tmp/$(PACKAGE) $$TARBALL;           \
	ln -s $$SRCDIR /tmp/$(PACKAGE);                 \
	cd /tmp;                                        \
        tar -czf $$TARBALL --exclude .svn $(PACKAGE)/*; \
	/bin/rm -f /tmp/$(PACKAGE);                     \
	/bin/mv /tmp/$$TARBALL $$SRCDIR;                \
	echo Placed as $$TARBALL
