# fil: ragen.conf
# $Id$
# 
# Configuration file for the report generator
#
# variables starts with '$', and comments with '#'
# values must be within double quates (") and lines must end with a semicolon (;)
# $sql is the sql-query. line break and white space is allowed.
# $order_by defines the default ordering of the sql query. By clicking on the column headers
#   in the report, you can sort/reverse sort on other criteria.
# $title ($overskrift) is the report title as shown on web
# $extra ($ekstra) are extra columns that can be used for hyperlinks (see $url)
# $hide ($skjul) are columns that must be included in the $sql because they are used in
#   a $url, see below. $hide will not show the column in the report.
# $sum shows the total of a given column (may not work...)
# $count angir kolonner som skal telles
# $name_MYCOL ($navn_MYCOL) changes the column header.
# $url_MYCOL makes a hyperlink
# $explain_MYCOL ($forklar_MYCOL) shows an explaination as popup in the browser when you
# hold the curser over the column header.
#
# ---------------------------------------------------------------------
# netbox related reports
#

netbox {
$sql="
SELECT roomid,sysname,ip,catid,sub,typeid,typename,
       orgid,netbox.up,modules,swport,gwport,
       'Mem',snmp,val AS Function,netbox.netboxid,prefixid
       FROM type
       RIGHT OUTER JOIN netbox USING (typeid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS gwport
                       FROM gwport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr3 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS sub
                       FROM netboxcategory
                       GROUP BY netboxid) tempaggr4 USING (netboxid)
       LEFT JOIN (SELECT netboxid,count(netboxid) AS snmp
                       FROM netboxsnmpoid
                       GROUP BY netboxid) tempaggr5 USING (netboxid)
       LEFT JOIN netboxinfo ON (netbox.netboxid=netboxinfo.netboxid AND var='function')
";
$hide = "netboxid,prefixid,typeid";
$order_by="roomid";
$title = "Devices in Operation";
$name_sysname="Name";
$name_catid="Cat";
$name_ip="IP address";
$name_typename="Type";
$name_roomid="Room";  
$name_orgid="Org";
$name_up="Up";
$url_roomid="room?roomid=$roomid";
$url_sysname="/browse/$sysname";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_ip="prefix?prefix.prefixid=$prefixid";
$url_catid="netbox?catid=$catid";
$url_sub="netboxinfo?netboxid=$netboxid";
$url_modules="modules?sysname=$sysname";
$url_Mem="mem?sysname=$sysname";
$url_swport="swport?b1.netboxid=$netboxid";
$url_gwport="gwport?netboxid=$netboxid";
$url_up="/status/history/?type=boxes&id=$netboxid";
$url_Function="netbox?val=$Function";
$url_snmp="netboxsnmpoid?netboxid=$netboxid";
$explain_Mem="Memory";
$explain_swp="Switch Ports";
$explain_gwp="Router Ports";
$explain_up="Status";
$explain_snmp="#SNMP OIDs classified";
$explain_sub="Sub category";
}

netboxinfo {
$sql="SELECT roomid,sysname,catid,category AS subcat,netboxid FROM netbox LEFT JOIN netboxcategory USING (netboxid)":
$overskrift="Netboxinfo";
$skjul="netboxid";
$url_subcat="netboxinfo?category=$subcat";
}

gw {
$sql="
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,gwport,netboxid,prefixid
       FROM type   
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS gwport
                       FROM gwport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       WHERE catid='GW' OR catid='GSW'";
$overskrift = "Routers"; $navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_main_sw="Software";
$navn_orgid="Org";
$navn_typename="Type";
$navn_roomid="Room";  
$order_by="roomid";   
$ekstra="memory";     
$skjul = "netboxid,typeid,prefixid";
$url_roomid="room?roomid=$roomid";  
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_gwport="gwport?netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
$forklar_gwport="Router Ports";
#$forklar_mod="Modules";
#$forklar_mem="Memory"; 
}

sw {
$sql="
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,swport,netboxid,prefixid
       FROM type
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)  
            LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
       WHERE catid='SW' OR catid='GSW'";
$overskrift = "Switches";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_ip="IP address";
$navn_orgid="Org";
$navn_typename="Type";
$navn_roomid="Room";
$order_by="roomid";
$ekstra="memory";
$skjul = "netboxid,typeid,prefixid,catid";
$url_roomid="room?roomid=$roomid";
#$url_ip="prefix?prefixid=$prefixid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
}

edge {
$sql="
SELECT roomid,sysname,host(ip),typeid,typename,orgid,catid,
       sw_ver AS Software,modules,swport,netboxid,prefixid
       FROM type
            RIGHT OUTER JOIN netbox USING (typeid)
            JOIN device USING (deviceid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS swport
                       FROM swport JOIN module USING (moduleid)
                       GROUP BY netboxid) tempaggr1 USING (netboxid)
            LEFT JOIN (SELECT netboxid,count(netboxid) AS modules
                       FROM module
                       GROUP BY netboxid) tempaggr2 USING (netboxid)
      WHERE catid='EDGE'";
$overskrift = "Edge switches";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_ip="IP address";
$navn_orgid="Org";
$navn_typename="Type";
$navn_roomid="Room";
$order_by="roomid";
$ekstra="memory";
$skjul = "netboxid,typeid,prefixid,catid";
$url_roomid="room?roomid=$roomid";
#$url_ip="prefix?prefixid=$prefixid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
}

# wlan - traadloest

wlan {
SELECT roomid AS Room,sysname,ip,catid,sw_ver as Software,count(distinct category) AS subcats,
       descr,prefixid,netboxid 
       FROM netbox 
       JOIN device USING (deviceid) 
       LEFT JOIN type USING (typeid) 
       LEFT JOIN netboxcategory USING (netboxid) 
   WHERE catid='WLAN' 
   GROUP BY roomid,sysname,ip,catid,sw_ver,descr,prefixid,netboxid";
$overskrift ="Wireless";
$skjul="prefixid,netboxid";
$order_by = "ip";
$navn_sysname = "Name";
$url_sysname = "/browse/$sysname";
$url_subcats="netboxinfo?netboxid=$netboxid";
$url_roomid = "room?roomid=$roomid"; 
$url_host(ip) = "prefix?prefixid=$prefixid";
}


srv {
$sql = "SELECT roomid,sysname,host(ip),catid,orgid, count(distinct category) as subcats,count(serviceid) as services, val as function, netbox.netboxid,prefixid FROM netbox LEFT JOIN service USING (netboxid) LEFT JOIN netboxcategory USING (netboxid) LEFT JOIN netboxinfo ON (netboxinfo.netboxid=netbox.netboxid AND netboxinfo.var='function') WHERE catid='SRV' GROUP BY roomid,sysname,host(ip),catid,orgid,val,netbox.netboxid,prefixid";
$overskrift = "Servers";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_ip="IP";
$navn_orgid="Org";
$navn_roomid="Room";
$order_by="roomid";
$skjul = "netboxid,prefixid";          
$url_subcats="netboxinfo?netboxid=$netboxid";
$url_ip="prefix?prefixid=$prefixid";
$url_roomid="room?roomid=$roomid";
$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_services="servicemon?netboxid=$netboxid";
$url_function="netbox?val=$function";
}


other {
$sql="SELECT roomid,sysname,host(ip),catid,category,orgid,netboxid FROM netbox LEFT JOIN netboxcategory USING (netboxid) WHERE catid='OTHER'";
$overskrift = "Other";
$order_by="roomid";
$skjul = "netboxid";
$url_roomid="room?roomid=$roomid";
#$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
}


servicemon {
$sql="SELECT sysname,handler,version,netboxid FROM service LEFT JOIN netbox USING (netboxid)";
$overskrift="Services being monitored";
$navn_orgid="Owner";
$skjul="netboxid";
$url_sysname="srv?sysname=$sysname";
}
 

device {
$sql = "select serial,roomid,sysname,module from device join module using (deviceid) join netbox using (netboxid)";
$overskrift = "Devices";
$navn_roomid="Room";
$navn_serial="Serial Number";
$navn_sysname="Netbox";
$navn_module="Module";
$order_by="roomid,sysname,module,serial";
$url_roomid="room?roomid=$roomid";
$url_sysname="netbox?sysname=$sysname";
#$url_module="swport?b1.sysname=$sysname&m1.module=$module";
}



# Denne kommer inn når netboxinfo kommer
#$sql="SELECT roomid,sysname,typeid,orgid,software FROM netbox,netboxinfo where 
#catid='GW' AND netbox.netboxid=netboxinfo.netboxid";

#modulecat {
#$sql="SELECT typename,sysName,module,serial,sw,hw FROM netbox JOIN module USING (netboxid) left join device using (deviceid) LEFT OUTER JOIN type USING (typeid) WHERE typegroupid='cat-sw' order by sysName,modulenumber";
#$navn_typename = "Type";
#$overskrift = "Catalyst";
#$order_by="sysname";
#}

#modultype {
#$sql="SELECT model,descr,count(model) AS antall FROM module GROUP BY model,descr";
#$overskrift=Modultyper";
#$url_antall="modules?model=$model";
#}

#masse ting tatt ut: model, ports portsup etc

modules {
$sql="SELECT roomid,sysname,module AS mn,model,descr,serial,sw_ver,hw_ver,fw_ver FROM netbox JOIN module USING (netboxid) join device on module.deviceid=device.deviceid";
$overskrift = "Modules";
$order_by="roomid,sysname,mn";
$url_roomid="room?roomid=$roomid";
$url_sysname="netbox?sysname=$sysname";
$url_mn="swport?b1.sysname=$sysname&m1.module=$mn";
$forklar_mn="Module number";
}

mem {
$sql="SELECT sysname,catid,typename,memtype,device,to_char(size,'999G999G999G999') as size,to_char(used,'999G999G999G999') as used,to_char(size-used,'999G999G999G999') AS free,TO_CHAR((used/(size+0.0001))*100, '999')::int AS used_pst FROM netbox JOIN mem USING (netboxid) LEFT JOIN type USING (typeid)";
$order_by="sysname,catid,memtype,device";
$overskrift = "Memory";
$navn_used_pst = "used %";
$url_sysname="netbox?sysname=$sysname";
$url_memtype="mem?memtype=$memtype";
$url_device="mem?device=$device";
$url_typename="type?typename=$typename";
}

# ---------------------------------------------------------------------
# ruterport/prefix-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interface,speed,gwip,vlan,nettype,netident,netboxid,prefix.prefixid FROM netbox JOIN module USING (netboxid) JOIN gwport USING (moduleid) JOIN gwportprefix USING (gwportid) JOIN prefix ON gwportprefix.prefixid=prefix.prefixid JOIN vlan USING (vlanid)";
$overskrift = "Router ports";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "netboxid,prefixid";
//nye navn
$navn_sysname="Router";
$navn_interface="Router port";
$navn_gwip="IP address";
$navn_speed="Mbps";
#$navn_netaddr="M";
#$navn_ospf="O";
#$navn_active_ip_cnt="No";
#$navn_prefixid="p";
$order_by="sysname,vlan,interface";
$url_gwip="prefix?prefix.prefixid=$prefixid";
$url_sysname="netbox?sysname=$sysname";
$url_vlan="swportv?vlan.vlan=$vlan";
#$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
#$forklar_m="Mask of subnet";
#$forklar_o="OSPF cost";
#$forklar_ant="No of computers";
#$sum="active_ip_cnt";
}
# krasjer alt av en eller annen grunn
# masklen(netaddr)
prefix {
$sql="SELECT host(netaddr),masklen(netaddr) as m,vlan,count(gwip) as antgw,nettype,netident,vlan.orgid,usageid,description,active_ip_cnt AS act,prefix.prefixid,vlan.vlanid FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) LEFT JOIN prefix_active_ip_cnt ON (prefix.prefixid=prefix_active_ip_cnt.prefixid) group by netaddr,vlan,nettype,netident,vlan.orgid,usageid,description,active_ip_cnt,prefix.prefixid,vlan.vlanid";
$overskrift = "Prefixes in use";
$order_by="netaddr";
$navn_netaddr = "Network";
$navn_m="Mask";
$skjul = "prefixid,vlanid";
$url_antgw="gwport?vlanid=$vlanid";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
$url_act="/machinetracker/ip?prefixid=$prefixid&days=-1";
$forklar_m="Mask of subnet";
#$forklar_komm="Comment";
$forklar_act="No of active IP's";
$forklar_antgw="No of gateways connected";
#$forklar_antnetbox="Netboxes connected";
$sum="act";
}

prefix1 {
$sql = "SELECT host(netaddr) as Network,masklen(netaddr) as Mask,gwip as Gateway,sysname,vlan.vlan,nettype,vlan.orgid,usageid,netident,prefix.prefixid,hsrp FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) JOIN module USING (moduleid) JOIN netbox USING (netboxid)";
$overskrift = "Prefixes";
$order_by="netaddr,gwip";
$navn_sysname="Netbox";
$navn_orgid="Org";

$skjul = "prefixid,hsrp";
$url_sysname="netbox?sysname=$sysname";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
##$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid?dns=on";
#$forklar_m="Mask of subnet";
#$forklar_komm="Comment";
#$forklar_ant="No of computers";
#$forklar_antgw="No of gateways connected";
#$forklar_antnetbox="Netboxes connected";
#$sum="active_ip_cnt";
}






# prefix rapport som også viser rutere
#masklen(netaddr),
prefixmgw {
$sql = "SELECT netaddr,sysname,vlan,nettype,netident,vlan.orgid,usageid,prefix.prefixid FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) JOIN module USING (moduleid) JOIN netbox USING (netboxid)";
$overskrift = "Prefixes in use, and their connected gateways";
$order_by="netaddr";
$navn_host(netaddr) = "Network";
$navn_masklen(netaddr)="M";
$navn_netaddr = "Network";
$navn_sysname = "Gateway";
$skjul = "prefixid";
$url_sysname="netbox?sysname=$sysname";
$url_host(netaddr)="gwport?prefixid=$prefixid";
$url_masklen(netaddr)="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også to_netboxid
swport0 {
$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,vlan.vlan,b2.sysname as to_netboxid,portname, swport.swportid, b1.netboxid as netboxiid,b1.catid FROM swport JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid)"
$overskrift = "Switchports";
#$skjul = "netboxiid,catid";
$skjul = "swportid,netboxiid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
#$url_port="/browse/$sysname/";
#$url_port="/browse/$sysname/module$module/port$port/";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_swportid="swport?swport.swportid=$swportid";
}
#$ekstra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port?up=$modul%3A$port";

swport {
$sql="SELECT b1.sysname,s1.interface, m1.module, s1.port, s1.link, s1.speed, s1.duplex, s1.media, s1.trunk, vlan.vlan,s1.portname, b2.sysname as to_netboxid,m2.module AS remote_module, s1.swportid, b1.netboxid as netboxid, b1.catid FROM swport AS s1 JOIN module AS m1 USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid)";
$overskrift="Switchports";
$skjul = "swportid,netboxid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Connected to netbox";
$navn_remote_module="Module";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
$url_port="/machinetracker/swp?switch=$sysname&module=$module&port=$port";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
#$url_remote_module="swport2?s1.swportid=$swportid";
$url_swportid="swport?swport.swportid=$swportid";
$forklar_to_netboxid="Netbox connected";
$forklar_remote_module="Module on connected netbox";
}

swport3 {
$sql="SELECT b1.sysname, m1.module, s1.port, s1.interface, s1.ifindex, s1.link, s1.speed, s1.duplex, s1.media, s1.trunk, vlan.vlan, b2.sysname as to_netboxid,m2.module AS remote_module, s1.portname, s1.swportid, b1.netboxid as netboxid, b1.catid FROM swport AS s1 JOIN module AS m1 USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid)";
$overskrift="Switchports - debug";
}

swportv {

$sql="SELECT 
b1.sysname,interface,module,port,link,speed,duplex,media,trunk,vlan.vlan,b2.sysname as to_netboxid,portname,swportid,b1.catid FROM netbox AS b1 JOIN module USING (netboxid) JOIN swport USING (moduleid) JOIN swportvlan USING (swportid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN vlan USING (vlanid)  WHERE b1.catid like '%SW'";
$overskrift = "Switchports with vlan number"; 
$skjul = "swportid,netboxid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port,vlan.vlan";
$url_sysname="netbox?sysname=$sysname";
#$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
}

topowalk {
$sql="SELECT b1.sysname,m1.module as module1,s1.port as port1,b2.sysname as tonetboxid,m2.module as module2,s2.port as port2 FROM swport AS s1 inner join module as m1 using (moduleid) JOIN netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) left join module as m2 on s2.moduleid=m2.moduleid";
#$order_by="b1.sysname,m1.module,s1.port";
#$overskrift = "Switch topology";
$ekstra="swbak,gwbak";
#$url_sysname="netbox?sysname=$sysname";
#$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$tonetboxid";
$url_swbak="topowalk?b1.sysname=$tonetboxid";
}

#kommer sikkert til å fungere like dårlig
topowalkgw{
$sql="SELECT b1.sysname,interface,b2.sysname as to_netboxid,module,s2.port FROM gwport JOIN module using (moduleid) join netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swport AS s2 ON (gwport.to_swportid=s2.swportid)";
$overskrift = "Router topology";
$order_by="b1.sysname,interface";
$ekstra="swbak,gwbak";
$url_sysname="netbox?sysname=$sysname";
$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$to_netboxid";
$url_swbak="topowalk?b1.sysname=$to_netboxid";
}



# ---------------------------------------------------------------------
# room,sted,type
#

room {
$sql="SELECT roomid,count(netboxid) AS nb,locationid,descr FROM room LEFT JOIN netbox USING (roomid) GROUP BY roomid,locationid,descr";
$overskrift = "Room";
$navn_roomid="Room";
$navn_nb="Netboxes";
$navn_locationid="Location";
$navn_descr="Description";
$forklar_devices="Number of registered IP devices in this room";
$order_by="roomid";
$url_nb="netbox?roomid=$roomid";
$url_locationid="location?locationid=$locationid";
#$sum="count(netboxid)";
}

location {
$sql="SELECT locationid,count(roomid) AS rooms,location.descr
FROM location LEFT JOIN room USING (locationid) GROUP BY locationid,location.descr";
$overskrift = "Locations";
$order_by="locationid";
$navn_locationid="Location";
$navn_descr="Description";
$url_rooms="room?locationid=$locationid";
}

type {
$sql="SELECT vendorid,typename,count(distinct netboxid) AS antip,count(moduleid) AS antmod,typeid,type.descr,sysobjectid FROM type left JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid) GROUP by type.typename,vendorid,typeid,type.descr,sysobjectid HAVING count(netbox)>0";         
$overskrift = "Types of equipment";
$navn_typename="Type";
$navn_vendorid="Vendor";
$navn_descr="Description";
$order_by="vendorid,typename";
$skjul = "typeid";
$url_vendorid="vendor?vendorid=$vendorid";
$url_antip="netbox?typeid=$typeid";     
$url_antmod="modules?typeid=$typeid";
$forklar_antip="Number of IP addresses related to this type";
$forklar_antmod="Number of modules related to this type";
}


vendor {
$sql = "SELECT vendorid,count(distinct netboxid) as antip,count(moduleid) as antmod FROM module right join netbox using (netboxid) join type using (typeid) right join vendor using (vendorid) group by vendorid order by vendorid";
$overskrift = "Vendors";
$navn_vendorid="Vendor";
$forklar_antip="Number of IP addresses related to this vendor";
$forklar_antmod="Number of modules related to this vendor";
$url_vendorid="type?vendorid=$vendorid";
}

product {
$sql = "select vendorid,productno,count(deviceid) as devs,descr from product right join device using (productid) group by vendorid,productno,descr";
$overskrift = "Products";
$navn_vendorid="Vendor";
$navn_productno="Product";
$navn_devs="Devices";
$forklar_devs="Number of devices registered";
$url_vendorid="type?vendorid=$vendorid";
$url_productno="device?productno=$productno";
}

# ---------------------------------------------------------------------
# usage,org
#
usage {
$sql="SELECT usageid,count(prefixid) AS antallnett,descr FROM usage LEFT JOIN vlan USING (usageid) LEFT JOIN prefix USING (vlanid) GROUP BY usageid,descr";    
$overskrift = "Usage";
$navn_antallnett = "Number of networks";
$navn_usageid="Usage"; 
$navn_descr="Description";
$order_by="usageid";
$url_antallnett="prefix?usageid=$usageid";
}

org {
$sql = "SELECT orgid,count(prefixid) AS antallnett,parent,descr,opt1 AS Contact FROM org LEFT JOIN vlan USING (orgid) LEFT JOIN prefix USING (vlanid) GROUP BY orgid,parent,descr,opt1";
$overskrift = "Organisation";
$navn_descr="Description";
$navn_parent="Parent";
$navn_orgid="Organisational unit";
$order_by="orgid";
$url_parent="org?parent=$parent";
$url_antallnett="prefix?orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,masklen(netaddr),host(ip),sysname FROM netbox JOIN prefix USING (prefixid) left outer join vlan using (vlanid) WHERE (catid='KANT' OR catid='SW') ORDER BY masklen(netaddr),vlan,host(ip)";
$overskrift = Switches/hubs sorted by mask size";
$navn_masklen(netaddr) = "Mask";
}
antkant {
# masklen(netaddr)
$sql = "select masklen(netaddr) as m,count(vlanid) as v,vlan from netbox join prefix using (prefixid) left outer join vlan using (vlanid) where (catid='KANT' OR catid='SW') group by vlan,m order by m,v desc";
$overskrift = "No of SW and KANT on each vlan";
$navn_m = "Mask";
$navn_v = "No";
}

fantkant{
$sql = "select netaddr,count(vlanid) as v,vlan from netbox join prefix using (prefixid) left outer join vlan using (vlanid) where (catid='KANT' OR catid='SW') group by vlan,netaddr";
}

netboxsnmpoid{
$sql="SELECT sysname,snmpoid,oidname,mib,oidkey,netboxid FROM netbox JOIN netboxsnmpoid USING (netboxid) JOIN snmpoid USING (snmpoidid)";
$overskrift="Supported SNMP OIDs";
$hide="netboxid";
$order_by="sysname,oidkey,snmpoid";
$url_sysname="netboxsnmpoid?sysname=$sysname";
$url_snmpoid="netboxsnmpoid?oidkey=$oidkey";
$order_by="snmpoid";
}


#############################

# spanning tree blocked
stpblock {
$sql = "SELECT swportblocked.vlan,sysname,module,port,link,portname from swportblocked JOIN swport USING (swportid) JOIN module USING (moduleid) JOIN netbox USING (netboxid) WHERE link='y'";
#$sql="SELECT swportblocked.vlan,sysname,modul,port,status,portnavn from swportblocked JOIN swport USING (swportid) JOIN boks USING (boksid) WHERE status='up'";
$order_by="vlan,sysname,module,port";
$overskrift = "STP blokkerte porter";
#$url_vlan="?rapport=swportv&vlan=$vlan";
#$url_sysname="?rapport=swportv&sysname=$sysname";
}



#
# EOF
#
