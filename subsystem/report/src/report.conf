# oversatt til v3 av vf 18.12.02

# fil: ragen.conf
# 
# Konfigurasjonsfil for rapportgeneratoren
#
# Navn på sikre rapporter (for internbrukere) må avslutte med _sec eks: netbox_sec
# variabler starter med '$', og kommentarer med '#'
# verdier må være innelukket i doble anførselstegn ("), og linjer må slutte med semikolon (;)
# $sql er sql-spørrelinja mot databasen
# $order_by er en ekstra måte å spesifisere sortering fra, brukes fra en lenke
# $overskrift er tabellens overskrift på websiden
# $ekstra er ekstra kolonner man vil sette inn for å lage ekstra lenker
# $skjul er kolonner som skal skjules fra visningen av resultatet
# $sum angir kolonner som skal summeres
# $count angir kolonner som skal telles
# $navn_MYCOL endrer en kolonneoverskrift
# $url_MYCOL tilordner en lenke til tabellruteinnholdet til en kolonne
# $forklar_MYCOL legger til en tekstlig forklaring i toppen av tabellen (fint for små kolonneoverskrifter, som ekstra-feltene)
#
# ---------------------------------------------------------------------
# netbox-relaterte rapporter
#
netbox {
$sql="SELECT roomid,sysname,ip,catid,typeid,typename,orgid,count(moduleid) AS Modules,netbox.up,netboxid,prefixid FROM type RIGHT OUTER JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid) GROUP by netboxid,prefixid,sysname,ip,catid, subcat,typeid,typename,roomid,orgid,netbox.up";
$overskrift = "Devices in Operation";
$order_by="roomid";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_catid="Cat";
#$navn_subcat="Subcat";
$navn_ip="IP address";
$skjul = "netboxid,prefixid,typeid";
$navn_typename="Type";
$navn_roomid="Room";
$navn_orgid="Org";
$navn_up="Up";
$ekstra="swp,gwp,mem";
$url_roomid="room?roomid=$roomid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_ip="prefix?prefixid=$prefixid";
$url_catid="netbox?catid=$catid";
$url_Modules="modules?sysname=$sysname";
$url_mem="mem?sysname=$sysname";
$url_swp="swport?b1.netboxid=$netboxid";
$url_gwp="gwport?netboxid=$netboxid";
$forklar_mem="Memory";
$forklar_swp="Switch Ports";
$forklar_gwp="Router Ports";
$forklar_up="Status";
}

gw {
$sql="SELECT roomid,sysname,typeid,typename,orgid,netboxid FROM type RIGHT OUTER JOIN netbox USING (typeid) WHERE (catid='GW' OR catid='GSW')";
$overskrift = "Routers";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_main_sw="Software";
$navn_orgid="Org";
$navn_typename="Type";
$navn_roomid="Room";
$order_by="roomid";
$ekstra="gwp,mod,mem";
$skjul = "netboxid,typeid";
$url_roomid="room?roomid=$roomid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_gwp="gwport?netboxid=$netboxid";
$url_mem="mem?sysname=$sysname";
$url_mod="modules?sysname=$sysname";
$forklar_gwp="Router Ports";
$forklar_mod="Modules";
$forklar_mem="Memory";
}

sw {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,netboxid 
FROM type RIGHT OUTER JOIN netbox USING (typeid) 
WHERE (catid='SW' OR catid='GSW')";
$overskrift = "Core Switches";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_ip="IP address";
$navn_orgid="Org";
$navn_typename="Type";
$navn_roomid="Room";
$order_by="roomid";
$ekstra="modules,memory,swport";
$skjul = "netboxid,typeid";
$url_roomid="room?roomid=$roomid";
$url_typename="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_swport="swport?b1.netboxid=$netboxid";
$url_memory="mem?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
}

edge {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,count(moduleid) as modules,netboxid,prefixid FROM type RIGHT OUTER JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid) WHERE catid='EDGE' GROUP by netboxid,prefixid,sysname,host(ip),typeid,typename,roomid,orgid";
$overskrift = "Edge switches and hubs";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$order_by="roomid";
#$ekstra="modules";
$skjul = "netboxid,prefixid,typeid";
$url_roomid="room?roomid=$roomid";
$url_typename="type?typeid=$typeid";
$url_ip="prefix?prefixid=$prefixid";
$url_orgid="org?orgid=$orgid";
#$url_mi="modules?sysname=$sysname";
$url_modules="modules?sysname=$sysname";
#$navn_modules = "Number of modules";
$navn_typename="Type";
$navn_host(ip)="IP";
$forklar_modules="Number of modules";
#$count = "moduleid";
#$sum="count(moduleid)";
}

# wlan - traadloest

wlan {
$sql = "select roomid,sysname,host(ip),catid,subcat,descr,prefixid from netbox left join type using (typeid) where catid='WLAN'"; 
$overskrift ="Wireless";
$order_by = "host(ip)";
$navn_sysname = "Name";
$url_sysname = "/browse/$sysname";
$url_roomid = "room?roomid=$roomid"; 
$url_host(ip) = "prefix?prefixid=$prefixid";
}


srv {
$sql="SELECT roomid,sysname,host(ip),catid,subcat,orgid,count(serviceid) as AntTjenMon,netboxid,prefixid FROM netbox LEFT JOIN service USING (netboxid) WHERE catid='SRV' GROUP BY roomid,sysname,host(ip),catid,subcat,orgid,netboxid,prefixid";
$overskrift = "Servers";
$navn_sysname="Name";
$url_sysname="/browse/$sysname";
$navn_ip="IP";
$navn_orgid="Org";
$navn_roomid="Room";
$order_by="roomid";
$skjul = "netboxid,prefixid";          
$url_ip="prefix?prefixid=$prefixid";
$url_roomid="room?roomid=$roomid";
$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
$url_AntTjenMon="servicemon?netboxid=$netboxid";
}


other {
$sql="SELECT roomid,sysname,host(ip),catid,subcat,orgid,netboxid FROM netbox WHERE catid='OTHER'";
$overskrift = "Other";
$order_by="roomid";
$skjul = "netboxid";
$url_roomid="room?roomid=$roomid";
#$url_typeid="type?typeid=$typeid";
$url_orgid="org?orgid=$orgid";
}


servicemon {
$sql="SELECT sysname,handler,version,netboxid FROM service LEFT JOIN netbox USING (netboxid)";
$overskrift="Services being monitored";
$navn_orgid="Owner";
$skjul="netboxid";
$url_sysname="srv?sysname=$sysname";
}
 

device {
$sql = "select vendorid,productno,serial,hw_ver,sw_ver from device join product using (productid) join vendor using (vendorid)";
$overskrift = "Devices";
}



# Denne kommer inn når netboxinfo kommer
#$sql="SELECT roomid,sysname,typeid,orgid,software FROM netbox,netboxinfo where 
#catid='GW' AND netbox.netboxid=netboxinfo.netboxid";

#modulecat {
#$sql="SELECT typename,sysName,module,serial,sw,hw FROM netbox JOIN module USING (netboxid) left join device using (deviceid) LEFT OUTER JOIN type USING (typeid) WHERE typegroupid='cat-sw' order by sysName,modulenumber";
#$navn_typename = "Type";
#$overskrift = "Catalyst";
#$order_by="sysname";
#}

#modultype {
#$sql="SELECT model,descr,count(model) AS antall FROM module GROUP BY model,descr";
#$overskrift=Modultyper";
#$url_antall="modules?model=$model";
#}

#masse ting tatt ut: model, ports portsup etc
modules {
$sql="SELECT roomid,sysname,module AS mn,typeid,typename,serial,catid,sw_ver,hw_ver FROM type RIGHT OUTER JOIN netbox USING (typeid) JOIN module USING (netboxid) join device on module.deviceid=device.deviceid";
$overskrift = "Modules";
$order_by="roomid,sysname,moduleid";
$skjul = "typeid";
$url_roomid="room?roomid=$roomid";
$url_sysname="netbox?sysname=$sysname";
$url_typename="type?typeid=$typeid";
$url_mn="swport?b1.sysname=$sysname&m1.module=$mn";
$forklar_mn="Module number";
}

mem {
$sql="SELECT sysname,catid,typename,memtype,device,size,used FROM netbox JOIN mem USING (netboxid) LEFT JOIN type USING (typeid)";
$order_by="sysname,catid,memtype,device";
$overskrift = "Memory";
$navn_(size/1024/1024)="Size";
$url_sysname="netbox?sysname=$sysname";
$url_memtype="mem?memtype=$memtype";
$url_device="mem?device=$device";
$url_typename="type?typename=$typename";
}

# ---------------------------------------------------------------------
# ruterport/prefix-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interface,netaddr,speed,vlan,netboxid FROM netbox JOIN module USING (netboxid) JOIN gwport USING (moduleid) JOIN gwportprefix USING (gwportid) JOIN prefix ON gwportprefix.prefixid=prefix.prefixid JOIN vlan ON prefix.vlanid=vlan.vlanid";
$overskrift = "Router ports";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "netboxid,prefixid";
//nye navn
$navn_sysname="Router";
$navn_interface="Router port";
$navn_gwip="IP address";
$navn_speed="Mbps";
$navn_netaddr="M";
$navn_ospf="O";
$navn_active_ip_cnt="No";
$navn_prefixid="p";
$order_by="sysname,vlan,interface";
$url_gwip="prefix?prefixid=$prefixid";
$url_sysname="netbox?sysname=$sysname";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
$forklar_m="Mask of subnet";
$forklar_o="OSPF cost";
$forklar_ant="No of computers";
$sum="active_ip_cnt";
}
# krasjer alt av en eller annen grunn
# masklen(netaddr)
prefix {
$sql="SELECT host(netaddr),masklen(netaddr) as m,vlan,count(gwip) as antgw,nettype,netident,vlan.orgid,usageid,description,prefixid FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) group by netaddr,vlan,nettype,netident,vlan.orgid,usageid,description,prefixid";
$overskrift = "Prefixes in use";
$order_by="netaddr";
$navn_netaddr = "Network";
$navn_m="Mask";
$skjul = "prefixid";
$url_antgw="gwport?vlan=$vlan";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
##$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid?dns=on";
$forklar_m="Mask of subnet";
#$forklar_komm="Comment";
#$forklar_ant="No of computers";
$forklar_antgw="No of gateways connected";
#$forklar_antnetbox="Netboxes connected";
#$sum="active_ip_cnt";
}

prefix2 {
$sql = "SELECT host(netaddr) as Network,masklen(netaddr) as Mask,gwip as Gateway,sysname,vlan.vlan,nettype,vlan.orgid,usageid,netident,prefix.prefixid,hsrp FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) JOIN module USING (moduleid) JOIN netbox USING (netboxid)";
$overskrift = "Prefixes";
$order_by="netaddr,gwip";
$navn_sysname="Netbox";
$navn_orgid="Org";

$skjul = "prefixid,hsrp";
#$url_antgw="gwport?vlan=$vlan";
#$url_antnetbox="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
##krasjer alt, av en eller annen grunn
##$url_active_ip_cnt="/res/arp/arp_sok.php?prefixid=$prefixid?dns=on";
#$forklar_m="Mask of subnet";
#$forklar_komm="Comment";
#$forklar_ant="No of computers";
#$forklar_antgw="No of gateways connected";
#$forklar_antnetbox="Netboxes connected";
#$sum="active_ip_cnt";
}






# prefix rapport som også viser rutere
#masklen(netaddr),
prefixmgw {
$sql = "SELECT netaddr,sysname,vlan,nettype,netident,vlan.orgid,usageid,prefix.prefixid FROM vlan JOIN prefix USING (vlanid) JOIN gwportprefix USING (prefixid) JOIN gwport USING (gwportid) JOIN module USING (moduleid) JOIN netbox USING (netboxid)";
$overskrift = "Prefixes in use, and their connected gateways";
$order_by="netaddr";
$navn_host(netaddr) = "Network";
$navn_masklen(netaddr)="M";
$navn_netaddr = "Network";
$navn_sysname = "Gateway";
$skjul = "prefixid";
$url_sysname="netbox?sysname=$sysname";
$url_host(netaddr)="gwport?prefixid=$prefixid";
$url_masklen(netaddr)="netbox?prefixid=$prefixid";
$url_vlan="swportv?vlan.vlan=$vlan";
$url_orgid="org?orgid=$orgid";
$url_usageid="usage?usageid=$usageid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også to_netboxid
swport0 {
$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,vlan.vlan,b2.sysname as to_netboxid,portname, swport.swportid, b1.netboxid as netboxiid,b1.catid FROM swport JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid)"
$overskrift = "Switchports";
#$skjul = "netboxiid,catid";
$skjul = "swportid,netboxiid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
#$url_port="/browse/$sysname/";
#$url_port="/browse/$sysname/module$module/port$port/";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_swportid="swport?swport.swportid=$swportid";
}
#$ekstra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port?up=$modul%3A$port";

swport {
$sql="SELECT b1.sysname, m1.module, s1.port, s1.link, s1.speed, s1.duplex, s1.media, s1.trunk, vlan.vlan, b2.sysname as to_netboxid,m2.module AS remote_module, s1.portname, s1.swportid, b1.netboxid as netboxid, b1.catid FROM swport AS s1 JOIN module AS m1 USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid) WHERE s1.port IS NOT NULL";
$overskrift="Switchports";
$skjul = "swportid,netboxid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox";
$navn_remote_module="Module";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox?sysname=$sysname";
$url_module="modules?sysname=$sysname&module=$module";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
#$url_remote_module="swport2?s1.swportid=$swportid";
$url_swportid="swport?swport.swportid=$swportid";
$forklar_to_netboxid="Netbox connected";
$forklar_remote_module="Module on connected netbox";
}

swport3 {
$sql="SELECT b1.sysname, m1.module, s1.port, s1.interface, s1.ifindex, s1.link, s1.speed, s1.duplex, s1.media, s1.trunk, vlan.vlan, b2.sysname as to_netboxid,m2.module AS remote_module, s1.portname, s1.swportid, b1.netboxid as netboxid, b1.catid FROM swport AS s1 JOIN module AS m1 USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swportvlan ON (s1.swportid=swportvlan.swportid AND trunk='f') left join vlan using(vlanid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) LEFT JOIN module AS m2 ON (s2.moduleid=m2.moduleid)";
$overskrift="Switchports - debug";
}

coreswportt {
$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,b2.sysname as to_netboxid,portname, swport.swportid FROM swport JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) WHERE trunk='t' AND b1.catid LIKE '%SW'";

$overskrift = "Trunked Core Switch Ports";
$skjul = "swportid,netboxid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
#$url_sysname="netbox?sysname=$sysname";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
#$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
}


swportv {
#$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,vlan,b2.sysname as to_netboxid,portname,swportid,b1.catid FROM swport JOIN swportvlan USING (swportid) JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) left join vlan using (vlanid) ORDER BY b1.sysname,module,port";

$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,vlan.vlan,b2.sysname as to_netboxid,portname,swportid,b1.catid FROM netbox AS b1 JOIN module USING (netboxid) JOIN swport USING (moduleid) JOIN swportvlan USING (swportid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN vlan USING (vlanid)";
$overskrift = "Switchports with vlan number";
$skjul = "swportid,netboxid,catid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$url_sysname="netbox?sysname=$sysname";
#$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
}



# Denne viser flere rader ved trunk, en rad for hvert vlan
#ikke vlan her.
coreswportv {
$sql="SELECT b1.sysname,module,port,link,speed,duplex,media,trunk,vlan,b2.sysname as to_netboxid,portname,swportid FROM swport JOIN swportvlan USING (swportid) JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) left join vlan using (vlanid) WHERE b1.catid like '%SW' ORDER BY b1.sysname,module,port";
$overskrift = "Switchports with vlan number";
$skjul = "swportid,netboxid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$url_sysname="netbox?sysname=$sysname";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
}

# Denne viser kun trunkporter. Vi viser også to_netboxid
swportt {
$sql="SELECT b1.sysname,module,port,link,speed,duplex,trunk,
b2.sysname as to_netboxid,portname, swport.swportid FROM swport JOIN module USING (moduleid) JOIN netbox AS b1 USING (netboxid) LEFT JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) WHERE trunk='t'";
$overskrift = "Trunked switchports";
$skjul = "swportid,netboxid";
$navn_sysname = "Switch";
$navn_to_netboxid = "Netbox connected";
$navn_speed = "Mbps";
$order_by="b1.sysname,module,port";
$url_sysname="netbox?sysname=$sysname";
$url_netboxid="netbox?netboxid=$netboxid";
$url_trunk="swportv?swportid=$swportid";
$url_vlan="prefix?vlan=$vlan";
$url_to_netboxid="netbox?sysname=$to_netboxid";
}

# topowalk
# funker dårlig, pga dagens ragen.conf-konfigurasjon

topowalk {
$sql="SELECT b1.sysname,m1.module as module1,s1.port as port1,b2.sysname as tonetboxid,m2.module as module2,s2.port as port2 FROM swport AS s1 inner join module as m1 using (moduleid) JOIN netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swport AS s2 ON (s1.to_swportid=s2.swportid) left join module as m2 on s2.moduleid=m2.moduleid";
#$order_by="b1.sysname,m1.module,s1.port";
#$overskrift = "Switch topology";
$ekstra="swbak,gwbak";
#$url_sysname="netbox?sysname=$sysname";
#$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$tonetboxid";
$url_swbak="topowalk?b1.sysname=$tonetboxid";
}

#kommer sikkert til å fungere like dårlig
topowalkgw{
$sql="SELECT b1.sysname,interface,b2.sysname as to_netboxid,module,s2.port FROM gwport JOIN module using (moduleid) join netbox AS b1 USING (netboxid) JOIN netbox AS b2 ON (to_netboxid=b2.netboxid) LEFT JOIN swport AS s2 ON (gwport.to_swportid=s2.swportid)";
$overskrift = "Router topology";
$order_by="b1.sysname,interface";
$ekstra="swbak,gwbak";
$url_sysname="netbox?sysname=$sysname";
$url_to_netboxid="netbox?sysname=$to_netboxid";
$url_gwbak="topowalkgw?b1.sysname=$to_netboxid";
$url_swbak="topowalk?b1.sysname=$to_netboxid";
}



# ---------------------------------------------------------------------
# room,sted,type
#

room {
$sql="SELECT roomid,count(netboxid) AS devices,locationid,descr FROM room LEFT JOIN netbox USING (roomid) GROUP BY roomid,locationid,descr";
$overskrift = "Room";
$navn_roomid="Room";
$navn_locationid="Location";
$navn_descr="Description";
$forklar_devices="Number of registered IP devices in this room";
$order_by="roomid";
$url_devices="netbox?roomid=$roomid";
$url_locationid="location?locationid=$locationid";
#$sum="count(netboxid)";
}

location {
$sql="SELECT locationid,count(roomid) AS rooms,location.descr
FROM location LEFT JOIN room USING (locationid) GROUP BY locationid,location.descr";
$overskrift = "Locations";
$order_by="locationid";
$navn_locationid="Location";
$navn_descr="Description";
$url_rooms="room?locationid=$locationid";
}

type {
$sql="SELECT vendorid,typename,count(distinct netboxid) AS antip,count(moduleid) AS antmod,typeid,type.descr,sysobjectid FROM type left JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid) GROUP by type.typename,vendorid,typeid,type.descr,sysobjectid HAVING count(netbox)>0";         
$overskrift = "Types of equipment";
$navn_typename="Type";
$navn_vendorid="Vendor";
$navn_descr="Description";
$ekstra="SNMPs";
$order_by="vendorid,typename";
$skjul = "typeid";
$url_vendorid="vendor?vendorid=$vendorid";
$url_antip="netbox?typeid=$typeid";     
$url_antmod="modules?typeid=$typeid";
$url_SNMPs="typesnmpoid?typeid=$typeid";     
$forklar_antip="Number of IP addresses related to this type";
$forklar_antmod="Number of modules related to this type";
$forklar_SNMPs="SNMPs responded to by this type. Not always polled";
}


vendor {
$sql = "SELECT vendorid,count(distinct netboxid) as antip,count(moduleid) as antmod FROM module right join netbox using (netboxid) join type using (typeid) right join vendor using (vendorid) group by vendorid order by vendorid";
$overskrift = "Vendors";
$navn_vendorid="Vendor";
$forklar_antip="Number of IP addresses related to this vendor";
$forklar_antmod="Number of modules related to this vendor";
$url_vendorid="type?vendorid=$vendorid";
}

product {
$sql = "select vendorid,productno,count(deviceid) as devs,descr from product right join device using (productid) group by vendorid,productno,descr";
$overskrift = "Products";
$navn_vendorid="Vendor";
$navn_productno="Product";
$navn_devs="Devices";
$forklar_devs="Number of devices registered";
$url_vendorid="type?vendorid=$vendorid";
$url_productno="device?productno=$productno";
}

# ---------------------------------------------------------------------
# usage,org
#
usage {
$sql="SELECT usageid,count(prefixid) AS antallnett,descr FROM usage LEFT JOIN vlan USING (usageid) LEFT JOIN prefix USING (vlanid) GROUP BY usageid,descr";    
$overskrift = "Usage";
$navn_antallnett = "Number of networks";
$navn_usageid="Usage"; 
$navn_descr="Description";
$order_by="usageid";
$url_antallnett="prefix?usageid=$usageid";
}
org {
$sql="SELECT orgid,count(prefixid) AS antallnett,parent,descr
FROM org LEFT JOIN vlan USING (orgid) LEFT JOIN prefix USING (vlanid) GROUP BY orgid,parent,descr";
$overskrift = "Organisation";
$navn_descr="Description";
$navn_parent="Parent";
$navn_orgid="Organisational unit";
$order_by="orgid";
$url_parent="org?parent=$parent";
$url_antallnett="prefix?orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,masklen(netaddr),host(ip),sysname FROM netbox JOIN prefix USING (prefixid) left outer join vlan using (vlanid) WHERE (catid='KANT' OR catid='SW') ORDER BY masklen(netaddr),vlan,host(ip)";
$overskrift = Switches/hubs sorted by mask size";
$navn_masklen(netaddr) = "Mask";
}
antkant {
# masklen(netaddr)
$sql = "select masklen(netaddr) as m,count(vlanid) as v,vlan from netbox join prefix using (prefixid) left outer join vlan using (vlanid) where (catid='KANT' OR catid='SW') group by vlan,m order by m,v desc";
$overskrift = "No of SW and KANT on each vlan";
$navn_m = "Mask";
$navn_v = "No";
}

fantkant{
$sql = "select netaddr,count(vlanid) as v,vlan from netbox join prefix using (prefixid) left outer join vlan using (vlanid) where (catid='KANT' OR catid='SW') group by vlan,netaddr";
}


typesnmpoid{
$sql="SELECT typename,oidkey,snmpoid,typesnmpoid.frequency,typeid FROM type JOIN typesnmpoid USING (typeid) JOIN snmpoid USING (snmpoidid)";
$overskrift="Typesnmpoid";
$hide="typeid";
$order_by="typename,oidkey,snmpoid";
}

#
# EOF
#
