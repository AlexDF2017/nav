 #
# fil: ragen.conf
# 
# Konfigurasjonsfil for rapportgeneratoren
#
# Navn på sikre rapporter (for internbrukere) må avslutte med _sec eks: boks_sec
# variabler starter med '$', og kommentarer med '#'
# verdier må være innelukket i doble anførselstegn ("), og linjer må slutte med semikolon (;)
# $sql er sql-spørrelinja mot databasen
# $order_by er en etkstra måte å spesifisere sortering fra, brukes fra en lenke
# $overskrift er tabellens overskrift på websiden
# $ekstra er ekstra kolonner man vil sette inn for å lage ekstra lenker
# $skjul er kolonner som skal skjules fra visningen av resultatet
# $sum angir kolonner som skal summeres
# $count angir kolonner som skal telles
# $navn_MYCOL endrer en kolonneoverskrift
# $url_MYCOL tilordner en lenke til tabellruteinnholdet til en kolonne
# $forklar_MYCOL legger til en tekstlig forklaring i toppen av tabellen (fint for små kolonneoverskrifter, som ekstra-feltene)
#
# ---------------------------------------------------------------------
# boks-relaterte rapporter
#

hei {
#284"/SELECT(.*)FROM/is""=""%"like""/(\w+)\s*$/"
$sql = "select roomid,sysname,host(ip),orgid from netbox where roomid>300";
$overskrift = "Alle bokser";
#$skjul = "orgid,tull";
$order_by = "roomid";
$ekstra = "tull";
$sum = "roomid,orgid";
$name_tull = "fanteri"
$url_sysname = "org-rapport?orgid=$orgid"
}
netbox {
$sql="SELECT roomid,sysname,host(ip),catid,subcat,typeid,typename,orgid,
count(moduleid) AS antmod,netboxid,prefixid 
FROM type RIGHT OUTER JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid) 
GROUP by netboxid,prefixid,sysname,host(ip),catid,subcat,typeid,typename,roomid,orgid";
$overskrift = "Utstyrsregister";
$order_by="roomid";
$navn_sysname="Navn";
$navn_catid="Kat";
$navn_subcat="Underkat";
$navn_host(ip)="IP-adresse";
$skjul = "netboxid,prefixid,typeid";
$navn_typename="Type";
$navn_roomid="Rom";
$navn_orgid="Drifter";
$ekstra="mem,swp,gwp,kart";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_host(ip)="?rapport=prefix&prefixid=$prefixid";
$url_catid="?rapport=netbox&catid=$catid";
$url_antmod="?rapport=modules&sysname=$sysname";
$url_mem="?rapport=mem&sysname=$sysname";
$url_swp="?rapport=swport&netboxid=$netboxid";
$url_gwp="?rapport=gwport&netboxid=$netboxid";
$url_kart="/vlanPlot/?netboxid=$netboxid";
$forklar_mem="Minne";
$forklar_swp="Svitsjeporter (om aktuelt)";
$forklar_gwp="Ruterporter (om aktuelt)";
}

sw {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,netboxid
FROM type RIGHT OUTER JOIN netbox USING (typeid)
WHERE (catid='SW' OR catid='GSW')";
$overskrift = "Svitsjer";
$navn_sysname="Navn";
$navn_host(ip)="IP-adresse";
$navn_orgid="Drifter";
$navn_typename="Type";
$navn_roomid="Rom";
$order_by="roomid";
$ekstra="moduler,minne,swport";
$skjul = "netboxid,typeid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_swport="?rapport=swport&netboxid=$netboxid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

srv {
$sql="SELECT
roomid,sysname,host(ip),catid,subcat,orgid,count(serviceid) as AntTjenMon,
netboxid,prefixid
FROM netbox LEFT JOIN service USING (netboxid) WHERE catid='SRV'
GROUP BY roomid,sysname,host(ip),catid,subcat,orgid,netboxid,prefixid";
$overskrift = "Servere";
$navn_sysname="Navn";
$navn_host(ip)="IP";
$navn_orgid="Drifter";
$navn_roomid="Rom";
$order_by="roomid";
$skjul = "netboxid,prefixid";
$url_host(ip)="?rapport=prefix&prefixid=$prefixid";
$url_roomid="?rapport=room&roomid=$roomid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_AntTjenMon="?rapport=servicemon&netboxid=$netboxid";
}

oppsop { 
$sql="SELECT
roomid,sysname,host(ip),catid,subcat,orgid,netboxid FROM netbox WHERE catid='NAS' OR catid='
REST'";
$overskrift = "Oppsop";
$order_by="roomid";
$skjul = "netboxid";
$url_roomid="?rapport=room&roomid=$roomid";
#$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}



boks {
$sql="SELECT roomid,sysname,host(ip),typeid,typename,orgid,
count(moduleid) AS antmod,netboxid,prefixid 
FROM type RIGHT OUTER JOIN netbox USING (typeid) LEFT JOIN module USING (netboxid)
GROUP by netboxid,prefixid,sysname,host(ip),typeid,typename,roomid,orgid";
$overskrift = "Utstyrsregister";
$order_by="roomid";
#$navn_sysname="Navn";
#$navn_host(ip)="IP-adresse";
#$skjul = "netboxid,prefixid,typeid";
#$navn_typename="Type";
#$navn_romid="Rom";
#$navn_orgid="Drifter";
#$ekstra="mem,swp,gwp,kart";
$url_romid="?rapport=rom&romid=$romid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_host(ip)="?rapport=prefiks&prefixid=$prefixid";
$url_kat="?rapport=boks&kat=$kat";
$url_antmod="?rapport=modules&sysname=$sysname";
$url_mem="?rapport=mem&sysname=$sysname";
$url_swp="?rapport=swport&netboxid=$netboxid";
$url_gwp="?rapport=gwport&netboxid=$netboxid";
$url_kart="/vlanPlot/?netboxid=$netboxid";
$forklar_mem="Minne";
$forklar_swp="Svitsjeporter (om aktuelt)";
$forklar_gwp="Ruterporter (om aktuelt)";
}

service {
$sql="SELECT romid,sysname,host(ip),typeid,typename,orgid,watch,netboxid,prefixid
FROM type RIGHT OUTER JOIN boks USING (typeid) WHERE active='N'";
$overskrift = "Enheter på service ";
$order_by="romid";
$navn_sysname="Navn";
$navn_host(ip)="IP-adresse";
$skjul = "netboxid,prefixid,typeid";
$navn_typename="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$navn_watch="Nede?";
$url_romid="?rapport=rom&romid=$romid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_host(ip)="?rapport=prefiks&prefixid=$prefixid";
}




gw {
$sql="SELECT romid,sysname,typeid,typename,orgid,main_sw,serial,netboxid FROM 
type RIGHT OUTER JOIN boks USING (typeid) LEFT JOIN boksinfo USING (netboxid) 
WHERE (kat='GW' OR kat='GSW')";
$overskrift = "Rutere";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typename="Type";
$navn_romid="Rom";
$order_by="romid";
$ekstra="gwp,mod,mem";
$skjul = "netboxid,typeid";
$url_romid="?rapport=rom&romid=$romid";
$url_typename="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_gwp="?rapport=gwport&netboxid=$netboxid";
$url_mem="?rapport=mem&sysname=$sysname";
$url_mod="?rapport=modules&sysname=$sysname";
$forklar_gwp="Ruterporter";
$forklar_mod="Moduler";
$forklar_mem="Minne";
}

# wlan - traadloese saker 
wlan{ 
$sql="select 
romid,sysname,host(ip),kat,kat2,descr,prefixid from boks left join type using (typeid) 
where kat='WLAN'"; $order_by="host(ip)"; 
$skjul="prefixid"; 
$overskrift="Trådløs nettel"; 
$url_romid="?rapport=rom&romid=$romid"; 
$url_host(ip)="?rapport=prefiks&prefixid=$prefixid"; 
} 


kant {
$sql="SELECT romid,sysname,host(ip),typeid,typename,orgid,
count(moduleid),netboxid,prefixid FROM type 
RIGHT OUTER JOIN boks USING (typeid) LEFT JOIN module USING (netboxid)
WHERE kat='KANT'
GROUP by netboxid,prefixid,sysname,host(ip),typeid,typename,romid,orgid";
$overskrift = "Kantutstyr";
$order_by="romid";
$ekstra="moduler";
$skjul = "netboxid,prefixid,typeid";
$url_romid="?rapport=rom&romid=$romid";
$url_typename="?rapport=type&typeid=$typeid";
$url_host(ip)="?rapport=prefiks&prefixid=$prefixid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_count(moduleid)="?rapport=modules&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
$navn_count(moduleid) = "Antall moduler";
$navn_typename="Type";
$navn_host(ip)="IP";
#$count = "moduleid";
#$sum="count(moduleid)";
}

kanttmp {
$sql="SELECT sysname,host(ip),modulenumber FROM boks JOIN module using (netboxid)
GROUP by sysname,host(ip)";
$overskrift = "PS40";
$order_by="host(ip)";
}

# Denne kommer inn når boksinfo kommer
#$sql="SELECT romid,sysname,typeid,orgid,software FROM boks,boksinfo where 
#kat='GW' AND boks.netboxid=boksinfo.netboxid";

modulecat {
$sql="SELECT typename,sysName,modulenumber,model,sw,hw 
FROM boks JOIN module USING (netboxid) LEFT OUTER JOIN type USING (typeid) 
WHERE typegruppe='cat-sw' order by
sysName,modulenumber";
$navn_typename = "Type";
$overskrift = "Catalyster";
$order_by="sysname";
}

modultype {
$sql="SELECT model,descr,count(model) AS antall FROM module 
GROUP BY model,descr";
$overskrift=Modultyper";
$url_antall="?rapport=modules&model=$model";
}

modules {
$sql="SELECT 
romid,sysname,typeid,typename,kat,modulenumber AS mn,
model,module.descr,sw,hw,serial,ports,portsup 
FROM type RIGHT OUTER JOIN boks USING (typeid) JOIN module 
USING (netboxid)";
$overskrift = "Moduler";
$order_by="romid,sysname,modulenumber";
$skjul = "typeid";
$url_romid="?rapport=rom&romid=$romid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_typename="?rapport=type&typeid=$typeid";
$url_mn="?rapport=swport&sysname=$sysname&modul=$mn";
$forklar_mn="Modulnummer";
}

mem {
$sql="SELECT sysname,kat,typename,memtype,device,size,used FROM boks 
JOIN mem USING (netboxid) LEFT JOIN type USING (typeid)";
$order_by="sysname,kat,memtype,device";
$overskrift = "Minne";
$navn_(size/1024/1024)="Size";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_memtype="?rapport=mem&memtype=$memtype";
$url_device="?rapport=mem&device=$device";
$url_typename="?rapport=type&typename=$typename";
}

# ---------------------------------------------------------------------
# ruterport/prefiks-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interf,speed,host(gwip),masklen(netaddr),vlan,nettype,
nettident,ospf,gwport.prefixid,netboxid,antmask 
FROM gwport LEFT JOIN prefiks USING (prefixid) JOIN boks USING (netboxid)";
$overskrift = "Ruterporter";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "netboxid,prefixid";
//nye navn
$navn_sysname="Ruter";
$navn_interf="Ruterport";
$navn_host(gwip)="IP-adresse";
$navn_speed="Mbps";
$navn_masklen(netaddr)="M";
$navn_ospf="O";
$navn_antmask="Ant";
$navn_prefixid="p";
$order_by="sysname,interf";
$url_host(gwip)="?rapport=prefiks&prefixid=$prefixid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_antmask="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
$forklar_m="Subnettmaske";
$forklar_o="OSPF kostnad";
$forklar_ant="Antall maskiner";
$sum="antmask";
}

# 
prefiks {
$sql="SELECT 
host(netaddr),masklen(netaddr),vlan,nettype,nettident,prefiks.orgid,anvid,komm,
antmask,count(distinct gwportid) as antgw,
count(distinct boks.netboxid) as antboks, prefixid FROM prefiks 
LEFT JOIN gwport USING (prefixid) LEFT JOIN boks USING (prefixid)
GROUP BY 
netaddr,vlan,nettype,nettident,prefiks.orgid,anvid,komm,antmask,prefixid"; 
$overskrift = "Subnett i bruk";
$order_by="netaddr";
$navn_host(netaddr) = "Nettadresse";
$navn_antmask="Ant";
$navn_masklen(netaddr)="M";
$skjul = "prefixid";
$url_antgw="?rapport=gwport&prefixid=$prefixid";
$url_antboks="?rapport=boks&prefixid=$prefixid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_anvid="?rapport=anv&anvid=$anvid";
$url_antmask="/res/arp/arp_sok.php?prefixid=$prefixid&dns=on";
$forklar_m="Subnettmaske";
$forklar_komm="Kommentar";
$forklar_ant="Antall maskiner";
$forklar_antgw="Antall rutere tilkoblet";
$forklar_antboks="Nettel/servere tilkoblet";
$sum="antmask";
}

# prefiks rapport som også viser rutere
prefiksmgw {
$sql="SELECT sysname,host(netaddr),masklen(netaddr),vlan,nettype,nettident,prefiks.orgid,anvid,antmask,prefiks.prefixid FROM 
prefiks,gwport,boks WHERE gwport.prefixid=prefiks.prefixid AND gwport.netboxid=boks.netboxid";
$overskrift = "Subnett i bruk med tilkoblede rutere";
$order_by="netaddr";
$navn_host(netaddr) = "Nettadresse";
$navn_masklen(netaddr)="M";
$navn_netaddr = "Nettadresse";
$navn_sysname = "Ruter";
$skjul = "prefixid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_host(netaddr)="?rapport=gwport&prefixid=$prefixid";
$url_masklen(netaddr)="?rapport=boks&prefixid=$prefixid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_anvid="?rapport=anv&anvid=$anvid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her. Vi viser også boksbak
swport {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,media,trunk,vlan,b2.sysname as boksbak,
portnavn, swport.swportid,swport.netboxid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN boks AS b1 USING (netboxid) LEFT JOIN boks AS b2 ON (boksbak=b2.netboxid)";
$overskrift = "Svitsjeporter";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="netboxid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_netboxid="?rapport=boks&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}
#$ekstra = "macbak";
#$url_macbak="/res/local/spor_port.php?ip=$port&up=$modul%3A$port";


# Denne viser flere rader ved trunk, en rad for hvert vlan
ikke vlan her.
swportv {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,media,trunk,vlan,b2.sysname as boksbak,
portnavn,swportid,swport.netboxid FROM swport JOIN swportvlan USING (swportid) 
JOIN boks AS b1 USING (netboxid) LEFT JOIN boks AS b2 ON (boksbak=b2.netboxid)  
WHERE b1.kat like '%SW'
ORDER BY b1.netboxid,modul,port";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="b1.netboxid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_netboxid="?rapport=boks&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}

# topowalk

topowalk{
$sql="SELECT b1.sysname,s1.modul,s1.port,b2.sysname as boksbak,s2.modul,s2.port FROM
swport AS s1 JOIN boks AS b1 USING (netboxid) JOIN boks AS b2 ON (boksbak=b2.netboxid)
LEFT JOIN swport AS s2 ON (s1.swportbak=s2.swportid)";
$order_by="b1.sysname,s1.modul,s1.port";
$overskrift = "Svitsje topologivisning";
$ekstra="swbak,gwbak";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksbak="?rapport=boks&sysname=$boksbak";
$url_gwbak="?rapport=topowalkgw&sysname=$boksbak";
$url_swbak="?rapport=topowalk&sysname=$boksbak";
}

topowalkgw{
$sql="SELECT b1.sysname,interf,b2.sysname as boksbak,s2.modul,s2.port FROM gwport
JOIN boks AS b1 USING (netboxid) JOIN boks AS b2 ON (boksbak=b2.netboxid)
LEFT JOIN swport AS s2 ON (gwport.swportbak=s2.swportid)";
$overskrift = "Ruter topologivisning";
$order_by="b1.sysname,interf";
$ekstra="swbak,gwbak";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksbak="?rapport=boks&sysname=$boksbak";
$url_gwbak="?rapport=topowalkgw&sysname=$boksbak";
$url_swbak="?rapport=topowalk&sysname=$boksbak";
}


# Denne viser kun trunkporter. Vi viser også boksbak
swportt {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,trunk,vlan,b2.sysname as boksbak,
portnavn, swport.swportid,swport.netboxid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN boks AS b1 USING (netboxid) LEFT JOIN boks AS b2 ON (boksbak=b2.netboxid) WHERE trunk='t'";
$overskrift = "Svitsjeporter";
$skjul = "swportid,netboxid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
#$order_by="netboxid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_netboxid="?rapport=boks&netboxid=$netboxid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
$url_boksbak="?rapport=boks&sysname=$boksbak";
}

# ---------------------------------------------------------------------
# rom,sted,type
#

rom {
$sql="SELECT romid,count(netboxid) AS antboks,stedid,descr FROM rom
LEFT JOIN boks USING (romid) GROUP BY romid,stedid,descr";
$overskrift = "Telematikkrom";
$forklar_antboks="Antall registrerte enheter i rommet.";
$order_by="romid";
$url_antboks="?rapport=boks&romid=$romid";
$url_stedid="?rapport=sted&stedid=$stedid";
#$sum="antboks";
}

sted {
$sql="SELECT stedid,count(romid) AS antallrom,sted.descr
FROM sted LEFT JOIN rom USING (stedid) GROUP BY stedid,sted.descr";
$overskrift = "Område";
$order_by="stedid";
$navn_descr="Beskrivelse";
$url_antallrom="?rapport=rom&stedid=$stedid";
}

type {
$sql="SELECT typename,count(distinct netboxid) AS antip,count(moduleid) AS antmod, 
vendorid,typeid,typegruppe,type.descr
FROM type JOIN boks USING (typeid) LEFT JOIN module USING (netboxid)
GROUP by typename,typeid,vendorid,typegruppe,type.descr";         
$overskrift = "Utstyrstyper";
$navn_typename="Type";
$navn_descr="Beskrivelse";
$order_by="typename";
$skjul = "typeid";
$url_antip="?rapport=boks&typeid=$typeid";     
$url_antmod="?rapport=modules&typeid=$typeid";     
$url_typegruppe="?rapport=typegruppe&typegroupid=$typegruppe";
$forklar_antip="Antall enheter av typen med IP-adresse";
$forklar_antmod="Antall moduler relatert til typen";
}
typegruppe {
$sql="SELECT typegroupid,descr FROM typegroup";
$overskrift = "Typegrupper";
$navn_typegroupid="Typegruppe";
$navn_descr="Beskrivelse";
$order_by="typegroupid";
}

# ---------------------------------------------------------------------
# anv,org
#
anv {
$sql="SELECT anvid,count(prefixid) AS antallnett,descr
FROM anv LEFT JOIN prefiks USING (anvid) GROUP BY anvid,descr";    
$overskrift = "Anvendelsestype ";
$navn_anvid="Anvendelse"; 
$navn_descr="Beskrivelse";
$order_by="anvid";
$url_antallnett="?rapport=prefiks&anvid=$anvid";
}
org {
$sql="SELECT orgid,count(prefixid) AS antallnett,forelder,descr
FROM org LEFT JOIN prefiks USING (orgid) GROUP BY orgid,forelder,descr";
$overskrift = "Organisasjon";
$navn_descr="Beskrivelse";
$navn_forelder="Mor";
$navn_orgid="Enhet";
$order_by="orgid";
$url_forelder="?rapport=org&orgid=$forelder";
$url_antallnett="?rapport=prefiks&orgid=$orgid";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,masklen(netaddr),host(ip),sysname FROM boks JOIN prefiks USING 
(prefixid) WHERE (kat='KANT' OR kat='SW') ORDER BY masklen(netaddr),vlan,host(ip)";
$overskrift = Switches/hubs sorted by mask size";
$navn_masklen(netaddr) = "Maske";
}
antkant {
$sql = "select masklen(netaddr),count(vlan),vlan from boks join prefiks using 
(prefixid) where (kat='KANT' OR kat='SW') 
group by vlan,masklen(netaddr) order by masklen(netaddr),count(vlan) desc";
$overskrift = "No of SW and KANT on each vlan";
$navn_masklen(netaddr) = "Maske";
$navn_count(vlan) = "Antall";
}

#
# EOF
#
