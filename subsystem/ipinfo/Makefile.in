SHELL = @SHELL@
INSTALL = @INSTALL@
CHEETAH = @CHEETAH@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@

pythonlibdir = @pythonlibdir@
webroot = @webroot@

top_srcdir = @top_srcdir@

config = ipinfo.conf

.PHONY: all install install-lib install-bin install-web install-images clean distclean install-conf

all:
	$(MAKE) -C templates $@

install: all install-lib install-bin install-web install-conf
	$(MAKE) -C templates $@

install-lib:
	$(INSTALL) -v -D -m 644 ipinfo/__init__.py \
	  $(DESTDIR)$(pythonlibdir)/nav/web/ipinfo/__init__.py
	$(INSTALL) -v -D -m 644 ipinfo/config.py \
	  $(DESTDIR)$(pythonlibdir)/nav/web/ipinfo/config.py

install-bin:

install-web:
	$(INSTALL) -v -D -m 644 .htaccess \
	  $(DESTDIR)$(webroot)/ipinfo/.htaccess

install-conf:
	@for file in $(config); do                             \
	  target=$(DESTDIR)$(sysconfdir)/webfront/$$file;      \
	  if [ -f "$$target" ]; then                           \
	    echo Skipping installation of config file $$file;  \
	  else                                                 \
	    $(INSTALL) -v -D -m 644 $$file $$target;           \
	  fi                                                   \
	done

clean:
	$(MAKE) -C templates $@
	@backups=`find . -name '*~'`; \
	rm -f $$backups

distclean: clean
	$(MAKE) -C templates $@
	rm -f Makefile
