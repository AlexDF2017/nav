{% extends "ipdevinfo/base.html" %}

{% block content %}

<table class="vertitable">
    <caption>Host: {{ host_info.host }}</caption>

    <tr>
        <th>Addresses</th>
        <td>
            {% if host_info.addresses %}
            <ul>
            {% for address in host_info.addresses %}
                <li>
                    <a href="{% url ipdevinfo-details-by-addr address.addr %}">{{ address.addr }}</a>
                    {% if address.name %}
                        (<a href="{% url ipdevinfo-details-by-name address.name %}">{{ address.name }}</a>)
                    {% endif %}
                    {% if address.error %}
                        ({{ address.error }})
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
            {% else %}
            None found
            {% endif %}
        </td>
    </tr>
</table>

<table class="vertitable">
{% if netbox %}
    <caption>IP Device: {{ netbox.sysname }}</caption>
    <tr>
        <th>Status</th>
        <td>{{ netbox.get_up_display|title }}</td>
    </tr>
    <tr>
        <th>Availability</th>
        <td>{{ netbox.availability }} <b>TODO</b>: Add availability method to Netbox model.</td>
    </tr>
    <tr>
        <th>Uptime</th>
        <td>
        {% ifequal netbox.up netbox.UP_UP %}
            {{ netbox.up_since|timesince }}
        {% else %}
            None
        {% endifequal %}
        </td>
    </tr>
    <tr>
        <th>IP address</th>
        <td>{{ netbox.ip }}</td>
    </tr>
    <tr>
        <th>Subnet</th>
        <td>{{ netbox.prefix }}</td>
    </tr>
    <tr>
        <th>Uplink</th>
        <td>{{ netbox.uplnk }} <b>TODO</b>: Add uplink method to Netbox model.</td>
    </tr>
    <tr>
        <th>Category</th>
        <td>{{ netbox.category }}</td>
    </tr>
    <tr>
        <th>Type</th>
        <td>{{ netbox.type }}</td>
    </tr>
    <tr>
        <th>Organization</th>
        <td>{{ netbox.organization }}</td>
    </tr>
    <tr>
        <th>Room</th>
        <td>{{ netbox.room }}</td>
    </tr>
    <tr>
        <th>Software</th>
        <td>{{ netbox.device.software_version }}</td>
    </tr>
    <tr>
        <th>Serial number</th>
        <td>{{ netbox.device.serial }}</td>
    </tr>
    <tr>
        <th># of modules</th>
        <td>{{ netbox.module_set.count }}</td>
    </tr>
    <tr>
        <th># of switch ports</th>
        <td>{{ netbox.get_swports.count }}</td>
    </tr>
    <tr>
        <th># of router ports</th>
        <td>{{ netbox.get_gwports.count }}</td>
    </tr>
    <tr>
        <th>Last updated</th>
        <td>{{ netbox.last_updated }}</td>
    </tr>
    <tr>
        <th>First discovered</th>
        <td>{{ netbox.discovered }}</td>
    </tr>
{% else %}
    <caption>IP Device</caption>
    <tr>
        <td>Sysname or IP "{{ host_info.host }}" was not found in NAV</td>
    </tr>
{% endif %}
</table>

<h3>Port view</h3>

<div class="tabs">
<ul>
    <li class="tabactive"><a>Switch port status</a></li>
    <li><a href="#" onClick="showPorts('activeports'); return false">Switch port activity</a></li>
    <li><a href="#" onClick="showPorts('gwportstatus'); return false">Router port status</a></li>
</ul>
</div>

<div class="tabcontent">

<div class="legend">
<table>
    <tr>
        <th>Speed legend</th>
        <td><span class="port passive">11</span> Not active</td>
        <td><span class="port disabled">11</span> Disabled</td>
        <td><span class="port Mb10">11</span> 10 Mbit</td>
        <td><span class="port Mb100">11</span> 100 Mbit</td>
        <td><span class="port Mb1000">11</span> 1 Gbit</td>
        <td><span class="port Mb10000">11</span> 10 Gbit</td>
    </tr>
    <tr>
        <th>Frame legend</th>
        <td><span class="port hduplex">11</span> Half duplex</td>
        <td><span class="port fduplex">11</span> Full duplex</td>
        <td><span class="port trunk">11</span> Trunk</td>
        <td><span class="port blocked">11</span> Blocked</td>
        <td></td>
        <td></td>
    </tr>
</table>
<p><em>Hold mouse over port for info, click for details.</em></p>
</div>

{% for module in netbox.module_set.all %}
<div class="module">
<h3><a href="{{ module.get_absolute_url }}">{{ module.module_number }}</a></h3>
<table>
    <tr>
    {% with module.swport_set.all as swports %}
    {% for swport in swports %}
        {% if swports|length_is:12 or swports|length_is:24 or swports|length_is:36 or swports|length_is:48 or swports|length_is:60 %}
            {% ifequal forloop.counter0 12 %}</tr><tr>{% endifequal %}
            {% ifequal forloop.counter0 24 %}</tr><tr>{% endifequal %}
            {% ifequal forloop.counter0 36 %}</tr><tr>{% endifequal %}
            {% ifequal forloop.counter0 48 %}</tr><tr>{% endifequal %}
        {% endif %}
        {% if swports|length_is:8 or swports|length_is:16 or swports|length_is:32 %}
            {% ifequal forloop.counter0 8 %}</tr><tr>{% endifequal %}
            {% ifequal forloop.counter0 16 %}</tr><tr>{% endifequal %}
            {% ifequal forloop.counter0 32 %}</tr><tr>{% endifequal %}
        {% endif %}
        <td
            class="port {% if swport.speed %}Mb{{ swport.speed|floatformat:0 }}{% endif %}{% ifnotequal swport.link 'y' %}{% ifequal swport.link 'd' %} disabled{% else %} passive{% endifequal %}{% endifnotequal %} FIXME"
            title="{{ swport.interface }}{% if swport.speed %}, {{ swport.speed|floatformat:0 }} Mbit{% endif %}{% if swport.to_netbox %} -> {{ swport.to_netbox.{% endif %}, FIXME">
            <a href="{{ swport.get_absolute_url }}">{{ swport.get_interface_display }}</a>
        </td>
    {% endfor %}
    {% endwith %}
    </tr>
</table>
</div>
{% endfor %}

</div>

{% endblock %}
