{% extends "ipdevinfo/base.html" %}

{% block content %}

<div id="hostinfo">
<table class="vertitable">
    <caption>Host: {{ host_info.host }}</caption>

    <tr>
        <th>Addresses</th>
        <td>
            {% if host_info.addresses %}
            <ul>
            {% for address in host_info.addresses %}
                <li>
                    <a href="{% url ipdevinfo-details-by-addr address.addr %}">{{ address.addr }}</a>
                    {% if address.name %}
                        (<a href="{% url ipdevinfo-details-by-name address.name %}">{{ address.name }}</a>)
                    {% endif %}
                    {% if address.error %}
                        ({{ address.error }})
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
            {% else %}
            None found
            {% endif %}
        </td>
    </tr>
</table>
</div>

<div id="ipdevinfo">
<table class="vertitable">
{% if netbox %}
    <caption>IP Device: {{ netbox.sysname }}</caption>
    <tr>
        <th>Status</th>
        <td>{{ netbox.get_up_display|title }}</td>
    </tr>
    <tr>
        <th>Availability</th>
        <td>
            {% with netbox.get_availability as availability %}
                {% if availability %}
                    <a href="#FIXME-link-to-rrd-view">
                    {{ availability.values.day|floatformat:2 }}%</a>,
                    <a href="#FIXME-link-to-rrd-view">
                    {{ availability.values.week|floatformat:2 }}%</a>,
                    <a href="#FIXME-link-to-rrd-view">
                    {{ availability.values.month|floatformat:2 }}%</a>
                    (day, week, month)
                {% else %}
                    Unknown
                {% endif %}
            {% endwith %}
        </td>
    </tr>
    <tr>
        <th>Uptime</th>
        <td>
        {% ifequal netbox.up netbox.UP_UP %}
            {{ netbox.up_since|timesince }}
        {% else %}
            None
        {% endifequal %}
        </td>
    </tr>
    <tr>
        <th>IP address</th>
        <td>{{ netbox.ip }}</td>
    </tr>
    <tr>
        <th>Prefix</th>
        <td>{{ netbox.prefix }}</td>
    </tr>
    <tr>
        <th>Uplink</th>
        <td>
            {% with netbox.get_uplinks as uplinks %}
                {% if uplinks %}
                    {% if uplinks|length_is:1 %}
                        <a href="{{ uplinks.0.get_absolute_url }}">
                            {{ uplinks.0 }}</a>
                    {% else %}
                        <ul>
                        {% for uplink in uplinks %}
                            <li><a href="{{ uplink.get_absolute_url }}">
                                {{ uplink }}</a></li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                {% else %}
                    Unknown
                {% endif %}
            {% endwith %}
        </td>
    </tr>
    <tr>
        <th>Category</th>
        <td><a href="{% url report-category netbox.category.id %}">
            {{ netbox.category }}</a></td>
    </tr>
    <tr>
        <th>Type</th>
        <td>
            {% if netbox.type %}
                <a href="{% url report-type netbox.type.id %}">
                    {{ netbox.type }}</a></td>
            {% else %}
                Unknown
            {% endif %}
    </tr>
    <tr>
        <th>Organization</th>
        <td><a href="{% url report-organization netbox.organization.id %}">
            {{ netbox.organization }}</a></td>
    </tr>
    <tr>
        <th>Room</th>
        <td><a href="{% url report-room netbox.room.id %}">
            {{ netbox.room }}</a></td>
    </tr>
    <tr>
        <th>Software</th>
        <td>{{ netbox.device.software_version }}</td>
    </tr>
    <tr>
        <th>Serial number</th>
        <td>{{ netbox.device.serial }}</td>
    </tr>
    <tr>
        <th># of modules</th>
        <td><a href="{% url report-modules netbox.sysname %}">
            {{ netbox.module_set.count }}</a></td>
    </tr>
    <tr>
        <th># of switch ports</th>
        <td><a href="{% url report-swport netbox.id %}">
            {{ netbox.get_swports.count }}</a></td>
    </tr>
    <tr>
        <th># of router ports</th>
        <td><a href="{% url report-gwport netbox.id %}">
            {{ netbox.get_gwports.count }}</a></td>
    </tr>
    <tr>
        <th>First discovered</th>
        <td>{{ netbox.discovered }}</td>
    </tr>
    <tr>
        <th>Last updated</th>
        <td>{{ netbox.last_updated }}</td>
    </tr>
    <tr>
        <th>Actions</th>
        <td>
            <ul>
                <li><a href="{% url editdb-edit-object "netbox",netbox.id %}">
                    Edit IP device</a></li>
                <li><a href="{% url maintenance-new-netbox netbox.id %}">
                    Schedule maintenance</a></li>
                <li><a href="{% url devicemanagement-history-netbox netbox.id %}">
                    View device history</a></li>
            </ul>
        </td>
    </tr>
{% else %}
    <caption>IP Device</caption>
    <tr>
        <td>Sysname or IP "{{ host_info.host }}" was not found in NAV</td>
    </tr>
{% endif %}
</table>
</div>

<hr class="floatclear" />

{% if netbox and netbox.module_set.count %}

<h3>Port view</h3>

{% if netbox.get_swports.count %}

<div id="swportstatus">
    <div class="tabs">
    <ul>
        <li class="tabactive"><a>Switch port status</a></li>
        <li><a href="#" onClick="showPorts('swportactive'); return false">Switch port activity</a></li>
        <li><a href="#" onClick="showPorts('gwportstatus'); return false">Router port status</a></li>
    </ul>
    </div>

    <div class="tabcontent">
    {% for module in netbox.module_set.all %}
    {% include "ipdevinfo/module-swport-status.html" %}
    {% endfor %}
    </div>
</div>

<div id="swportactive" style="display: none;">
    <div class="tabs">
    <ul>
        <li><a href="#" onClick="showPorts('swportstatus'); return false">Switch port status</a></li>
        <li class="tabactive"><a>Switch port activity</a></li>
        <li><a href="#" onClick="showPorts('gwportstatus'); return false">Router port status</a></li>
    </ul>
    </div>

    <div class="tabcontent">
    {% for module in netbox.module_set.all %}
    {% include "ipdevinfo/module-swport-active.html" %}
    {% endfor %}
    </div>
</div>

{% endif %}

{% if netbox.get_gwports.count %}

<div id="gwportstatus" style="display: none;">
    <div class="tabs">
    <ul>
        <li><a href="#" onClick="showPorts('swportstatus'); return false">Switch port status</a></li>
        <li><a href="#" onClick="showPorts('swportactive'); return false">Switch port activity</a></li>
        <li class="tabactive"><a>Router port status</a></li>
    </ul>
    </div>

    <div class="tabcontent">
    {% for module in netbox.module_set.all %}
    {% include "ipdevinfo/module-gwport-status.html" %}
    {% endfor %}
    </div>
</div>

{% endif %}

{% include "ipdevinfo/port-legend.html" %}

{% endif %}

{% if netbox %}
<h3>Statistics</h3>

<p>FIXME</p>
{% endif %}

{% endblock %}
