##
## This is the makefile for statTools
##

SHELL = @SHELL@
INSTALL = @INSTALL@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sysconfdir = @sysconfdir@

webroot = @webroot@
tooldir = @tooldir@
datarootdir = @datarootdir@
docdir = @docdir@
crondir = @crondir@
libdir = @libdir@
pythonlibdir = @pythonlibdir@

binaries = cleanrrds.pl makecricketconfig.pl mcc.py
conffiles = cricket-views.conf mcc.conf
tool = stats.tool
libfiles = $(wildcard nav/*.py nav/rrd/*.py nav/mcc/*.py)

.PHONY: all install install-lib install-bin install-conf install-web clean distclean install-doc install-cron

all: 
	$(MAKE) -C sortedStats $@

install: install-bin install-conf install-web install-cron install-doc install-lib
	$(MAKE) -C sortedStats $@

install-bin:
	@for file in $(binaries); do \
	  $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(bindir)/$$file || exit 1; \
	done

install-conf:
	@for file in $(conffiles); do                          \
	  target=$(DESTDIR)$(sysconfdir)/$$file;               \
	  if [ -f "$$target" ]; then                           \
	    echo Skipping installation of config file $$file;  \
	  else                                                 \
	    $(INSTALL) -v -D -m 644 $$file $$target || exit 1; \
	  fi;                                                  \
	done

install-web:
	$(INSTALL) -D -v -m 644 $(tool) $(DESTDIR)$(tooldir)/$(tool)

install-lib:
	@for file in $(libfiles); do 					             \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; \
	done

install-doc:
	documentation=`find cricket -type f -not -path '*/.svn/*' -not -name '*~'`; \
	for file in $$documentation; do                                             \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(docdir)/$$file || exit 1;      \
	done

install-cron:
	$(INSTALL) -D -v -m 644 cricket.cron $(DESTDIR)$(crondir)/cricket

clean:
	rm -f *~
	$(MAKE) -C sortedStats $@

distclean: clean
	rm -f Makefile
	$(MAKE) -C sortedStats $@
