##
## This is the makefile for statTools
##

SHELL = @SHELL@
INSTALL = @INSTALL@
CHEETAH = @CHEETAH@

prefix = @prefix@
exec_prefix = @exec_prefix@
sysconfdir = @sysconfdir@

libdir = @libdir@
pythonlibdir = @pythonlibdir@
templatedir = ${pythonlibdir}/nav/web/templates

webroot = @webroot@

conffiles = sortedStats.conf
templates = SortedStatsTemplate.py
libfiles = sortedStats.py

.PHONY: all install install-lib install-bin install-conf install-web clean distclean install-doc install-cron

all: $(templates)

install: install-conf install-lib install-web

$(templates): %.py: %.tmpl
	$(CHEETAH) compile $<


install-conf:
	@for file in $(conffiles); do                          \
	  target=$(DESTDIR)$(sysconfdir)/$$file;               \
	  if [ -f "$$target" ]; then                           \
	    echo Skipping installation of config file $$file;  \
	  else                                                 \
	    $(INSTALL) -v -D -m 644 $$file $$target || exit 1; \
	  fi;                                                  \
	done

install-web:
	$(INSTALL) -v -D -m 644 htaccess $(DESTDIR)$(webroot)/sortedStats/.htaccess

install-lib: $(templates)
	for file in $(templates); do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(templatedir)/$$file || exit 1; \
	done
	for file in $(libfiles); do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/nav/web/$$file || exit 1; \
	done

clean:
	rm -f *~
	rm -f $(templates)

distclean: clean
	rm -f Makefile


