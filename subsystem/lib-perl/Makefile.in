##
## Makefile for lib-perl
##
SHELL = @SHELL@
INSTALL = @INSTALL@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@
localstatedir = @localstatedir@
initdir = @initdir@

perllibdir = @perllibdir@
pathmodule = src/NAV/Path.pm

.PHONY: all install install-lib clean distclean

all: $(pathmodule)

$(pathmodule): Makefile
	@echo "Generating $(pathmodule) ..."
	@echo "#!/usr/bin/env perl" > $(pathmodule)
	@echo "# This file was generated during NAV build" >> $(pathmodule)
	@echo "package NAV::Path;" >> $(pathmodule)
	@echo "\$$prefix=\"$(prefix)\";" >> $(pathmodule)
	@echo "\$$exec_prefix=\"$(exec_prefix)\";" >> $(pathmodule)
	@echo "\$$bindir=\"$(bindir)\";" >> $(pathmodule)
	@echo "\$$libdir=\"$(libdir)\";" >> $(pathmodule)
	@echo "\$$perllibdir=\"$(perllibdir)\";" >> $(pathmodule)
	@echo "\$$sysconfdir=\"$(sysconfdir)\";" >> $(pathmodule)
	@echo "\$$initdir=\"$(initdir)\";" >> $(pathmodule)
	@echo "\$$localstatedir=\"$(localstatedir)\";" >> $(pathmodule)
	@echo "1;" >> $(pathmodule)

install: install-lib

install-lib: $(pathmodule)
	cd src; \
	installable=`find . -name '*.pm'`; \
	for file in $$installable; do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)/$(perllibdir)/$$file || exit 1; \
	done
clean:
	backups=`find src -name '*~'`; \
	rm -f $$backups
	rm -f *~
	rm -f $(pathmodule)

distclean: clean
	rm -f Makefile
