#encoding UTF-8
## Cheetah!
## $Id$
##
## Copyright 2003, 2004 Norwegian University of Science and Technology
##
## This file is part of Network Administration Visualized (NAV)
##
## NAV is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.
##
## NAV is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with NAV; if not, write to the Free Software
## Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
##
##
## Authors: John Magne Bredal <john.m.bredal@ntnu.no>
##


#extends nav.web.templates.MainTemplate.MainTemplate


##################################################
## Start of maincontent
##################################################
#block content
##################################################

<h2>Arnold</h2>

$printMenu($buttons, $buttonnames, $action)

<div class="tabcontent">

#if $action == 'search'
  $printSearch()

  <div class='infobox'>
    <h4>Usage</h4>

    <p>Search by choosing searchfield and then enter a value. Choose if what
    you are searching for is enabled, disabled or both. Enter the number of
    days back in time (0 being today) you want to limit your search to.</p>

    <ul>
      <li>IP format: Standard inet-values accepted (e.g. 129.241.xxx.xxx, 129.241.xxx.xxx/xx)</li>
      <li>MAC format: Hexadecimal values with no padding.</li>
      <li>Netbios, DNS and Orgid accept all characters and words.</li>
    </ul>

  </div>
#elif $action == 'showdetails'
  $printList($headertext, "", $list, $headersList, $headers, 1, 0)
  <h3>History</h3>
  $printList($headertext2, $hitstext2, $list2, $headersList2, $headers2, $hits2, 1)

#elif $action == 'addreason'
  $printAddreason($blockreasonheadersList, $blockreasonheaders, $blockreasons, $hits)

#elif $action == 'history'
  $printList($headertext, $hitstext, $list, $headersList, $headers, $hits, 1)

  <form action="history" method="get">
    <input type="text" name="days" size="3" value="$days" />days of history (based on lastchanged)
    <button type="submit">Change</button>
  </form>

#elif $action == 'blockedports'
  #if $output
    <p class='red'>$output</p>
  #end if
  $printList($headertext, $hitstext, $list, $headersList, $headers, $hits, 1)

#elif $action == 'manualblock'
  $printManualblock($reasons)

  <div class='infobox'>
    <h4>Usage</h4>

    <p>Enter IP address to block and choose reason for block. If you want you
    can add a comment. Autoenable is the number of days until the port will be
    automatically enabled. If not entered, the port will stay blocked until
    manually opened.</p>
  </div>

  #if $output
    <p class='red'>$output</p>
  #end if
#elif $action == 'blocktypes'
  $printList($headertext, $hitstext, $list, $headersList, $headers, $hits, 1)

  <p><a href='addBlocktype'>Add new blocktype</a></p>
#elif $action == 'addBlocktype'
  $addBlocktype($blockreasons)

#elif $action == 'printError'
  <p class="error">$error</p>

#end if

</div> ## tabcontent

#end block



##################################################
##################################################
##                  Functions                   ##
##################################################
##################################################



## Print the links in the $buttons-array
##################################################
#def printMenu($buttons, $buttonnames, $action)
##################################################

<div class="tabs">
<ul>
#for $button in $buttonnames
    #if $buttons[$button] == $action
    <li class="tabactive"><a href="$buttons[$button]">$button</a></li>
    #else
    <li><a href="$buttons[$button]">$button</a></li>
    #end if
#end for
</ul>
</div>

#end def


##################################################
# Generic function that prints a table based on input
#def printList($headertext, $hitstext, $list, $headersList, $headers, $hits, $printHits)
##################################################


<table class="listtable">
    <caption>$headertext</caption>

## HEADERS / ROW DESCRIPTIONS

#if len($list)
    <thead>
        <tr>
#for $entry in $headersList
            <th>
        #if $sort and $action == 'history'
                <a href="$section?sort=$entry&days=$days" class="navbar" title="">$headers[$entry]</a>
        #elif $sort
                <a href="$section?sort=$entry" class="navbar" title="">$headers[$entry]</a>
        #else
                $headers[$entry]
        #end if
            </th>
#end for
        </tr>
    </thead>


## THE INFORMATION / TABLE

    <tbody>
#for $listitem in $list
        <tr class="$rowcycler">
#for $entry in $headersList
            <td class="$cellcycler">$listitem[$entry]</td>
#end for
        </tr>
#end for
    </tbody>
#end if ## len($list)

#if $printHits
    <tbody class="footer">
        <tr>
            <th colspan="0">$hits $hitstext</th>
        </tr>
    </tbody>
#end if
</table>
#end def


##################################################
#def printSearch()
##################################################


<form action="search" method="get">
<input type="hidden" name="action" value="dosearch" />

<table class="vertitable">
    <tr>
        <th>
<select name="searchfield">
#for $entry in $searchfields
    #if $entry == $searchfield
    <option value="$entry" selected="selected">$entry</option>
    #else
    <option value="$entry">$entry</option>
    #end if
#end for
</select>
        </th>
        <td>
<input type="text" name="searchtext" value="$searchtext" size="20" />
        </td>
    </tr>
    <tr>
        <th>Status</th>
        <td>
<select name="status">
#for $item in $statusfields
    #if $item == $status
    <option value="$item" selected="selected">$item</option>
    #else
    <option value="$item">$item</option>
    #end if
#end for
</select>
        </td>
    </tr>
    <tr>
        <th>Date</th>
        <td>
<input type="text" name="days" value="$days" size="4" maxsize="4" />
days back
        </td>
    </tr>
    <tr>
        <th></th>
        <td>
<button type="submit">Search</button>
        </td>
    </tr>
</table>


</form>

#if $searchresults
$printList($headertext, $hitstext, $searchresults, $headersList, $headers, $hits, 1)
#elif $searchtext
<p>$headertext</p>
#end if

#end def

##################################################
#def printAddreason ($blockreasonheadersList, $blockreasonheaders, $blockreasons, $hits)
##################################################

  $printList($headertext, $hitstext, $blockreasons, $blockreasonheadersList, $blockreasonheaders, $hits, 1)

  <form action="doaddblockreason" method="get">
    <input type="text" name="blockreason" size="30" />
    <button type="submit">Add reason</button>
  </form>

#end def

##################################################
#def printManualblock($reasons)
##################################################

<form action="domanualblock" method="get">

<table class="vertitable">
    <tr>
        <th>IP address to block</th>
        <td><input type="text" name="ipadresse" /></td>
    </tr>
    <tr>
        <th>Reason</th>
        <td>
            <select name="reason">
            #for $reason in $reasons
                <option value="$reason['id']">$reason['text']</option>
            #end for
            </select>
            <a href="addreason">Add block reason</a>
        </td>
    </tr>
    <tr>
        <th>Comment</th>
        <td><input type="text" name="comment" /></td>
    </tr>
    <tr>
        <th>Autoenable in</th>
        <td><input type="text" name="autoenable" size="3" /> days</td>
    </tr>
    <tr>
        <th></th>
        <td><button type="submit">Block</button></td>
    </tr>
</table>

</form>

#end def


##################################################
#def addBlocktype($blockreasons)
##################################################

<h3>Add blocktype</h3>

<form action="doaddblock" method="get">

<table class="vertitable">

    #if $blockinfo['blockid']
    <input type="hidden" name="blockid" value="$blockinfo['blockid']" />
    <tr>
        <th>ID</th>
        <td>$blockinfo['blockid']</td>
    </tr>
    #end if

    <tr>
        <th>Title *</th>
        <td><input type="text" name="blocktitle" value="$blockinfo['blocktitle']" /></td>
    </tr>

    <tr>
        <th>Description</th>
        <td><textarea cols="40" name="description">$blockinfo['blockdesc']</textarea></td>
    </tr>

    <tr>
        <th>Reason *</th>
        <td>
<select name="reasonid">
    #if $blockinfo['reasonid'] == 0
    <option value="0" selected="selected">Select reason</option>
    #end if

    #for $element in $blockreasons
        #if $blockinfo['reasonid'] == $element['id']
    <option value="$element['id']" selected="selected">$element['text']</option>
        #else
    <option value="$element['id']">$element['text']</option>
        #end if
    #end for
</select>
#if not $blockinfo['blockid']
or <input type="text" name="newreason" value="-- Create new reason --" />
#end if
        </td>
    </tr>

    <tr>
        <th>Path to mailfile *</th>
        <td><input type="text" name="mailfile" value="$blockinfo['mailfile']" /></td>
    </tr>

    <tr>
        <th>Path to inputfile</th>
        <td><input type="text" name="inputfile" value="$blockinfo['inputfile']" /></td>
    </tr>

    <tr>
        <th>Block pursuit</th>
        <td>
#if $blockinfo['determined'] == 'y'
<input type="radio" name="pursuit" value="n" /> Open on move
<input type="radio" name="pursuit" value="y" checked="checked" /> All closed
#else
<input type="radio" name="pursuit" value="n" checked="checked" /> Open on move
<input type="radio" name="pursuit" value="y" /> All closed
#end if
        </td>
    </tr>

    <tr>
        <th>Exponential increase</th>
        <td>
#if $blockinfo['incremental'] == 'y'
<input type="checkbox" name="eincrease" checked="checked" />
#else
<input type="checkbox" name="eincrease" />
#end if
        </td>
    </tr>

    <tr>
        <th>Block duration *</th>
        <td><input size="3" type="text" name="duration" value="$blockinfo['blocktime']" /> days</td>
    </tr>

    <tr>
        <th>Active</th>
        <td>
#if $blockinfo['active'] == 'y'
            <input type="checkbox" name="active" checked="checked" />
#else
            <input type="checkbox" name="active" />
#end if
        </td>
    </tr>

    <tr>
        <th>User</th>
        <td><input type="text" name="user" value="$blockinfo['userid']" size="10" /></td>
    </tr>

    <tr>
        <th></th>
        <td>
#if $blockinfo['blockid']
            <button type="submit">Save changes</button>
#else
            <button type="submit">Add blocktype</button>
#end if
        </td>
    </tr>
</table>

</form>

#if $blockinfo['blockid']
  <p>Last changed $blockinfo['lastedited'] by $blockinfo['lastedituser']</p>
#end if

#end def

#def additionalCSS ()
$default_tabs_CSS()
$default_table_CSS()
#end def
