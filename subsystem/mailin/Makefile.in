#! /usr/bin/env make
# -*- coding: utf-8 -*-
#
# Copyright (C) 2008,2009 University of Troms√∏
#
# This file is part of Network Administration Visualized (NAV).
#
# NAV is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License version 2 as published by the Free
# Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
# more details.  You should have received a copy of the GNU General Public
# License along with NAV. If not, see <http://www.gnu.org/licenses/>.
#

# Programs
INSTALL = @INSTALL@

# Paths
prefix = @prefix@
bindir = @bindir@
libdir = @libdir@
exec_prefix = @exec_prefix@
datarootdir = @datarootdir@
sysconfdir = @sysconfdir@
initdir = @initdir@
localstatedir = @localstatedir@
tooldir = @tooldir@
pythonlibdir = @pythonlibdir@
djangotmpldir = @djangotmpldir@
webroot = @webroot@
docdir = @docdir@

# Files
INITFILES =
BINS = mailin.py
LIBS = $(wildcard nav/mailin/*.py nav/mailin/plugins/*.py)
CONFFILES = mailin.conf 
DOCFILES = README $(wildcard config/*/*)

.PHONY: all lib bin conf web install install-lib install-bin install-conf uninstall clean distclean

all: lib bin conf web
lib: $(TEMPLATES)
bin:
conf:
web:

install: all install-lib install-bin install-conf install-doc

install-lib: lib $(TEMPLATES)
	for file in $(LIBS) $(TEMPLATES); do $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done

install-bin: bin
	for file in $(BINS); do $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(bindir)/$$file || exit 1; done
	for file in $(INITFILES); do $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(initdir)/$$file	|| exit 1; done

install-conf: conf
	@for file in $(CONFFILES); do \
		target=$(DESTDIR)$(sysconfdir)/$$file; \
		if [ -f "$$target" ]; then \
			echo "Skipping installation of config file $$file"; \
		else \
			$(INSTALL) -v -D -m 644 config/$$file $$target || exit 1; \
		fi \
	done

install-doc:
	@for file in $(DOCFILES); do \
	  $(INSTALL) -v -m 644 -D $$file $(DESTDIR)$(docdir)/mailin/$$file || exit 1; \
	done

uninstall:
	for file in $(BINS); do rm -f $(DESTDIR)$(bindir)/$$file || exit 1; done
	for file in $(LIBS); do rm -f $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done

clean:
	find -name *.pyc -print0 | xargs -0 rm -f
	for file in $(TEMPLATES); do rm -f $$file $$file.bak; done

distclean: clean
	find -name \*~ -print0 | xargs -0 rm -f
	rm -f Makefile
