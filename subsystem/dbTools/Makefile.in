##
## This is the makefile for dbTools
##

SHELL = @SHELL@
INSTALL = @INSTALL@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sysconfdir = @sysconfdir@
initdir = @initdir@
libdir = @libdir@
pythonlibdir = @pythonlibdir@
crondir = @crondir@
localstatedir = @localstatedir@

binaries = dump.py pg_backup.pl navclean.py
libraries = dump.py
cronfiles = backup.cron
conffiles = pg_backup.conf

.PHONY: all install install-bin install-lib clean distclean install-lib install-cron install-conf

all: 

install: install-bin install-lib install-cron install-conf

install-bin:
	@for file in $(binaries); do \
	  $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(bindir)/$$file || exit 1; \
	done
	@$(INSTALL) -v -d -m 775 $(DESTDIR)$(localstatedir)/pg_backup

install-lib:
	@for file in $(libraries); do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/nav/$$file || exit 1; \
	done

install-cron:
	@for file in $(cronfiles); do \
	  targetfile=`echo $$file | sed 's/\.cron//'`; \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(crondir)/$$targetfile || exit 1; \
	done

install-conf:
	@for file in $(conffiles); do                          \
	  target=$(DESTDIR)$(sysconfdir)/$$file;               \
	  if [ -f "$$target" ]; then                           \
	    echo Skipping installation of config file $$file;  \
	  else                                                 \
	    $(INSTALL) -v -D -m 644 $$file $$target || exit 1; \
	  fi;                                                  \
	done

clean:
	rm -f *~ *.txt

distclean: clean
	rm -f Makefile
