{% load filters %}
<form action="{% url devicehistory-view %}" method="get">
    {% for type, elements in selection.items %}
        {% for id in elements %}
            <input type="hidden" name="view_{{ type }}" value="{{ id }}" />
        {% endfor %}
    {% endfor %}
    <table class="vertitable">
        <tr>
            <th>From:</th>
            <td><input type="text" name="from_date" value="{{ from_date }}" /></td>
        </tr>
        <tr>
            <th>To:</th>
            <td><input type="text" name="to_date" value="{{ to_date }}" /></td>
        </tr>
        <tr>
            <th>Type:</th>
            <td>
                <select name="type">
                <option value="all">All</option>
                {% for e,alert_types in event_type.items %}
                    <optgroup label="{{ e }}">
                        <option value="e_{{ e }}"
                        {% if e.id|in_list:selected_types.event %}
                        selected="selected"
                        {% endif %}>All {{ e }}</option>
                    {% for a in alert_types %}
                        <option value="a_{{ a.id }}" 
                        {% if a.id|stringformat:"s"|in_list:selected_types.alert %}
                            selected="selected"
                        {% endif %}>{{ a.name }}</option>
                    {% endfor %}
                    </optgroup>
                {% endfor %}
                </select>
            </td>
        </tr>
        <tr>
            <th></th>
            <td><button type="submit">Filter</button></td>
        </tr>
    </table>
</form>
