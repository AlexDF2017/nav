#!/usr/bin/env make
# 
# This file is part of the NAV project and sånt
# 

# paths

prefix=@prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
pythonlibdir=@pythonlibdir@
bindir=@bindir@
sysconfdir=@sysconfdir@
initdir=@initdir@
localstatedir=@localstatedir@
rrddir=$(localstatedir)/rrd
INITFILES=pping servicemon
BINS=checkService.py pping.py servicemon.py
LIBS=
CONFFILES=servicemon.conf pping.conf
# programs to use for make
INSTALL=@INSTALL@

.PHONY: install-lib install-bin install-checker install-conf

# ok, the targets
all: 
lib:
bin:
conf:
checker:

# the install
install: install-lib install-bin install-checker install-conf

install-lib: lib
	mkdir -p $(DESTDIR)$(rrddir)
	chmod 775 $(DESTDIR)$(rrddir)
	for file in nav/statemon/*.py; do $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done
	for file in nav/statemon/DNS/*.py; do $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done
install-bin: bin
	for file in $(BINS);do $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(bindir)/$$file || exit 1;done
	for file in $(INITFILES); do $(INSTALL) -v -D -m 755 $$file $(DESTDIR)$(initdir)/$$file || exit 1; done
install-checker: checker
	for file in nav/statemon/checker/*.py; do $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done
	for file in nav/statemon/checker/*.descr; do $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; done
install-conf: conf
	@for file in $(CONFFILES); do                          \
	  target=$(DESTDIR)$(sysconfdir)/$$file;               \
	  if [ -f "$$target" ]; then                           \
	    echo Skipping installation of config file $$file;  \
	  else                                                 \
	    $(INSTALL) -v -D -m 644 $$file $$target || exit 1; \
	  fi;                                                  \
	done

uninstall:
	for file in $(BINS); do rm -f $(DESTDIR)$(bindir)/$$file; done	
	rm -rf $(DESTDIR)$(pythonlibdir)
	rm -rf $(DESTDIR)$(pythonlibdir)
clean:
	find -name *.pyc -print0 | xargs --null rm -f

distclean: clean
	find -name '*~' -print0 | xargs --null rm -f
	rm Makefile
