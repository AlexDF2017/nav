##
## Makefile for lib-python
##
SHELL = @SHELL@
INSTALL = @INSTALL@
CHEETAH = @CHEETAH@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
sysconfdir = @sysconfdir@
localstatedir=@localstatedir@
pythonlibdir = @pythonlibdir@
djangotmpldir = @djangotmpldir@
webroot = @webroot@
initdir = @initdir@
VERSION = @VERSION@
pathmodule = nav/buildconf.py

DJANGO_TEMPLATES_SRC = $(wildcard templates/* templates/*/*)
DJANGO_TEMPLATES = $(DJANGO_TEMPLATES_SRC:templates/%=%)

.PHONY: all install install-lib install-bin clean distclean

all: $(pathmodule)

$(pathmodule): Makefile
	@echo "Generating $(pathmodule) ..."
	@echo "# This file was generated during NAV build" > $(pathmodule)
	@echo "prefix=\"$(prefix)\"" >> $(pathmodule)
	@echo "exec_prefix=\"$(exec_prefix)\"" >> $(pathmodule)
	@echo "bindir=\"$(bindir)\"" >> $(pathmodule)
	@echo "libdir=\"$(libdir)\"" >> $(pathmodule)
	@echo "pythonlibdir=\"$(pythonlibdir)\"" >> $(pathmodule)
	@echo "sysconfdir=\"$(sysconfdir)\"" >> $(pathmodule)
	@echo "localstatedir=\"$(localstatedir)\"" >> $(pathmodule)
	@echo "webroot=\"$(webroot)\"" >> $(pathmodule)
	@echo "initdir=\"$(initdir)\"" >> $(pathmodule)
	@echo "djangotmpldir=\"$(djangotmpldir)\"" >> $(pathmodule)
	@echo "VERSION=\"$(VERSION)\"" >> $(pathmodule)

install: install-lib install-bin

install-lib: $(pathmodule)
	@installable=`find nav -name '*.py'`; \
	for file in $$installable; do \
	  $(INSTALL) -v -D -m 644 $$file $(DESTDIR)$(pythonlibdir)/$$file || exit 1; \
	done
	@for file in $(DJANGO_TEMPLATES); do \
	  $(INSTALL) -v -D -m 644 templates/$$file $(DESTDIR)$(djangotmpldir)/$$file || exit 1; \
	done

install-bin:
	@cd bin; \
	$(INSTALL) -v -D -m 755 hasPrivilege.py $(DESTDIR)$(bindir)/hasPrivilege.py

clean:
	backups=`find src -name '*~'`; \
	rm -f $$backups
	rm -f *~
	rm -f $(pathmodule)

distclean: clean
	rm -f Makefile
