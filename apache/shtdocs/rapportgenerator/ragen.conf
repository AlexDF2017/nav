#
# fil: ragen.conf
# 
# Konfigurasjonsfil for rapportgeneratoren

# ---------------------------------------------------------------------
# boks-relaterte rapporter
#

boks {
$sql="SELECT romid,sysname,ip,kat,kat2,typeid,orgid,boksid,prefiksid
FROM boks";
$overskrift = "Utstyrsregister ";
$order_by="romid";
$navn_sysname="Navn";
$navn_ip="IP-adresse";
$skjul = "boksid,prefiksid";
$navn_typeid="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$ekstra="moduler,minne";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_kat="?rapport=boks2&kat=$kat";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

boks2 {
$sql="SELECT romid,sysname,ip,kat,kat2,typeid,orgid,
count(moduleid),boksid,prefiksid FROM boks JOIN module USING (boksid)
GROUP by boksid,prefiksid,sysname,ip,kat,kat2,typeid,romid,orgid";
$overskrift = "Utstyrsregister med mer info ";
$order_by="romid";
$navn_sysname="Navn";
$navn_ip="IP-adresse";
$skjul = "boksid,prefiksid";
$navn_typeid="Type";
$navn_romid="Rom";
$navn_orgid="Drifter";
$ekstra="moduler,minne";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

gw {
$sql="SELECT romid,sysname,typeid,orgid,main_sw,serial,boksid FROM 
boks LEFT JOIN boksinfo USING (boksid) WHERE kat='GW'";
$overskrift = "Rutere";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typeid="Type";
$navn_romid="Rom";
$order_by="romid";
$ekstra="ruterporter,moduler,minne";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_ruterporter="?rapport=gwport&boksid=$boksid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

sw {
$sql="SELECT romid,sysname,ip,typeid,orgid,main_sw,serial,boksid FROM boks 
LEFT JOIN boksinfo USING (boksid) WHERE kat='SW'";
$overskrift = "Svitsjer";
$navn_sysname="Navn";
$navn_main_sw="Software";
$navn_orgid="Drifter";
$navn_typeid="Type";
$navn_romid="Rom";
$order_by="romid";
$ekstra="svitsjeporter,moduler,minne";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_svitsjeporter="?rapport=swport&boksid=$boksid";
$url_minne="?rapport=mem&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

srv {
$sql="SELECT romid,sysname,ip,kat,kat2,orgid,function,boksid,prefiksid 
FROM boks 
LEFT JOIN boksinfo USING (boksid) WHERE kat='SRV'";
$overskrift = "Servere";
$navn_sysname="Navn";
$navn_orgid="Drifter";
$navn_romid="Rom";
$order_by="romid";
$skjul = "boksid,prefiksid";          
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}

# Denne virker ikke dan vi ikke klarer AND pr dato.
#$sql="SELECT romid,sysname,ip,kat,kat2,orgid,boksid FROM boks 
#WHERE kat<>'SRV' AND kat<>'GW' AND kat<>'SRV' AND kat<>'kant'";

oppsop {
$sql="SELECT romid,sysname,ip,kat,kat2,orgid,boksid FROM boks 
WHERE kat='TS'";
$overskrift = "Oppsop";
$order_by="romid";
$skjul = "boksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_orgid="?rapport=org&orgid=$orgid";
}


kant {
$sql="SELECT romid,sysname,ip,typeid,orgid,
count(moduleid),boksid,prefiksid FROM boks JOIN module USING (boksid)
WHERE kat='KANT'
GROUP by boksid,prefiksid,sysname,ip,typeid,romid,orgid";
$overskrift = "Kantutstyr";
$order_by="romid";
$ekstra="moduler";
$skjul = "boksid,prefiksid";
$url_romid="?rapport=rom&romid=$romid";
$url_typeid="?rapport=type&typeid=$typeid";
$url_ip="?rapport=prefiks&prefiksid=$prefiksid";
$url_orgid="?rapport=org&orgid=$orgid";
$url_count(moduleid)="?rapport=modules&sysname=$sysname";
$url_moduler="?rapport=modules&sysname=$sysname";
}

kanttmp {
$sql="SELECT sysname,ip,modulenumber FROM boks JOIN module using (boksid)
GROUP by sysname,ip";
$overskrift = "PS40";
$order_by="ip";
}

# Denne kommer inn når boksinfo kommer
#$sql="SELECT romid,sysname,typeid,orgid,software FROM boks,boksinfo where 
#kat='GW' AND boks.boksid=boksinfo.boksid";

modulecat {
$sql="SELECT typeid,sysName,modulenumber,model,sw,hw FROM boks JOIN module USING
(boksid) JOIN type USING (typeid) where typegruppe='cat-sw' order by
sysName,modulenumber";
$overskrift = "Catalyster";
$order_by="sysname";
}
modules {
$sql="SELECT typeid,sysname,typeid,kat,modulenumber,model,descr,sw,hw,serial FROM 
boks JOIN module 
USING (boksid)";
$overskrift = "Moduler";
$order_by="sysname,modulenumber";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_typeid="?rapport=type&typeid=$typeid";
}

mem {
$sql="SELECT sysname,kat,typeid,memtype,device,size,used FROM boks JOIN mem USING 
(boksid)";
$order_by="sysname,kat,memtype,device";
$overskrift = "Minne";
$navn_(size/1024/1024)="Size";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_memtype="?rapport=mem&memtype=$memtype";
$url_device="?rapport=mem&device=$device";
}

# ---------------------------------------------------------------------
# ruterport/prefiks-relaterte rapporter
#
gwport {
$sql= "SELECT sysname,interf,speed,gwip,maske,vlan,nettype,nettident,ospf,
gwport.prefiksid,boksid 
FROM gwport LEFT JOIN prefiks USING (prefiksid) JOIN boks USING (boksid)";
$overskrift = "Ruterporter";
#kolonner som må være med i søket, men som helst ikke bør vises.
$skjul = "boksid,prefiksid";
//nye navn
$navn_sysname="Navn";
$navn_interf="Ruterport";
$navn_gwip="IP-adresse";
$navn_speed="Mbps";
$navn_prefiksid="p";
$order_by="sysname,interf";
$url_gwip="?rapport=prefiks&prefiksid=$prefiksid";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_vlan="?rapport=swportv&vlan=$vlan";
}
prefiks {
$sql="SELECT nettadr,maske,vlan,nettype,nettident,orgid,anvid,antmask,prefiksid FROM 
prefiks";
$overskrift = "Subnett i bruk";
$order_by="nettadr";
$navn_nettadr = "Nettadresse";
$skjul = "prefiksid";
$url_nettadr="?rapport=gwport&prefiksid=$prefiksid";
$url_maske="?rapport=boks&prefiksid=$prefiksid";
$url_vlan="?rapport=swportv&vlan=$vlan";
$url_orgid="?rapport=org&orgid=$orgid";
$url_anvid="?rapport=anv&anvid=$anvid";
}

# ---------------------------------------------------------------------
# svitsjeport-relatert rapporter
#

# Denne viser trunk som en rad og angir ikke vlan her.
swport {
$sql="SELECT sysname,modul,port,status,speed,duplex,trunk,vlan,
portnavn, swport.swportid,swport.boksid FROM swport
LEFT JOIN swportvlan ON (swport.swportid=swportvlan.swportid AND trunk='f')
JOIN boks USING (boksid)";
$overskrift = "Svitsjeporter";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
}

# Denne viser flere rader ved trunk, en rad for hvert vlan
ikke vlan her.
swportv {
$sql="SELECT sysname,modul,port,status,speed,duplex,trunk,vlan,
portnavn, swportid,swport.boksid FROM swport 
LEFT JOIN swportvlan USING (swportid) 
JOIN boks USING (boksid)";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,boksid";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
}

swportv2 {
$sql="SELECT b1.sysname,modul,port,status,speed,duplex,trunk,vlan,b2.sysname as per,
portnavn,swportid,swport.boksid FROM swport JOIN swportvlan USING (swportid) 
JOIN boks AS b1 USING (boksid) LEFT JOIN boks AS b2 ON (boksbak=b2.boksid)  
ORDER BY b1.boksid,modul,port";
$overskrift = "Svitsjeporter med vlan";
$skjul = "swportid,boksid";
$navn_per = "Tilkoblet";
$navn_sysname = "Svitsj";
$navn_speed = "Mbps";
$order_by="b1.boksid,modul,port";
$url_sysname="?rapport=boks&sysname=$sysname";
$url_per="?rapport=boks&sysname=$per";
$url_boksid="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
$url_vlan="?rapport=prefiks&vlan=$vlan";
}

# Disse brukes ikke 
swportvlan{
$sql="SELECT swportid,vlan,retning FROM swportvlan";
$overskrift="Vlandefinisjoner";
$order_by="swportid";
}
swport {
$sql="SELECT swportid,boksid,modul,port,status,speed,duplex,trunk,portnavn FROM swport"; 
$overskrift = "Svitsjeporter";
$order_by="boksid,modul,port";
$url_swportid="?rapport=swportvlan&swportid=$swportid";
$url_boksid="?rapport=boks&boksid=$boksid";
}
swportt {
$sql="SELECT 
sysname,modul,port,status,speed,duplex,trunk,portnavn,swportid,boksid
FROM swport JOIN boks USING (boksid) WHERE trunk='t'";
$overskrift = "Trunker";
$skjul="swportid,boksid";
$order_by="boksid,modul,port";
$url_sysname="?rapport=boks&boksid=$boksid";
$url_trunk="?rapport=swportv&swportid=$swportid";
}


# ---------------------------------------------------------------------
# rom,sted,type
#

rom {
$sql="SELECT romid,stedid,descr,rom2,rom3 FROM rom";
$overskrift = "Telematikkrom";
$order_by="romid";
$navn_rom2="byggnr";
$navn_rom3="romnr";
$sum="romid";
$url_stedid="?rapport=sted&stedid=$stedid";
}
sted {
$sql="SELECT stedid,descr FROM sted";
$overskrift = "Område";
$navn_descr="Beskrivelse";
$ekstra
}
type {
$sql="SELECT typeid,descr FROM type";
$overskrift = "Utstyrstyper ";
$navn_typeid="Type";
$navn_descr="Beskrivelse";
$order_by="typeid";
}

# ---------------------------------------------------------------------
# anv,org
#
anv {
$sql="SELECT anvid,descr FROM anv";
$overskrift = "Anvendelsestype ";
$navn_anvid="Anvendelse";
$navn_descr="Beskrivelse";
$order_by="anvid";
}
org {
$sql="SELECT forelder,orgid,descr,org2 FROM org";
$overskrift = "Organisasjon";
$navn_descr="Beskrivelse";
$navn_org2="Kontaktperson";
$navn_forelder="Mor";
$navn_orgid="Enhet";
$order_by="orgid";
$url_forelder="?rapport=org&orgid=$forelder";
}

# ---------------------------------------------------------------------
# andre rapporter
#
listkant {
$sql= "SELECT vlan,maske,ip,sysname FROM boks JOIN prefiks USING 
(prefiksid) WHERE (kat='KANT' OR kat='SW') ORDER BY maske,vlan,ip";
$overskrift = Switches/hubs sorted by mask size";
}
antkant {
$sql = "select maske,count(vlan),vlan from boks join prefiks using 
(prefiksid) where (kat='KANT' OR kat='SW') 
group by vlan,maske order by maske,count(vlan) desc";
$overskrift = "Number of *-sw/*-h on uach vlan";
}

#
# EOF
#
