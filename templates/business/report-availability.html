{% extends 'business/report.html' %}


{% block report-content %}

  <h3>{{ report.report_name }}</h3>

  <p>
    {{ report.description  }}
  </p>


  {# Form for choosing period #}
  <div>
    I want a report for
    <form id="report-form" class="inline-form">
      <select name="report-month">
        {% for month in months %}
          {{ start }}
          {{ month }}
          <option value="{{ month.year }}-{{ month.month }}"
                  {% if start == month %}selected{% endif %}
                  >
            {{ month|date:'F Y' }}
          </option>
        {% endfor %}
      </select>
      <input type="submit" class="button small" value="Fetch report">
    </form>
  </div>


  {# Display records #}
  {% if records %}

    <table id="record-table" class="listtable expandable">
      <caption>
        Availability report for {{ start|date:'F Y' }}
      </caption>

      {# Table header #}
      <thead>
        <tr>
          <th>Subject</th>
          <th>Incidents</th>
          <th>Downtime</th>
          <th>Availability</th>
        </tr>
      </thead>

      {# Table body #}
      <tbody>

        {% for record in records %}
          {# Main information row #}
          <tr class="record-row">
            <td>{{ record.subject|default_if_none:'<em>N/A</em>' }}</td>
            <td>
              {{ record.incidents|length }}
              <a href="javascript:void(0);" class="toggle-incident pull-right">
                Show
              </a>
            </td>
            <td>{{ record.downtime }}</td>
            <td>{{ record.availability|floatformat:"-5" }}%</td>
          </tr>

          {# Hidden incidents row #}
          <tr class="hidden incident-row">
            <td colspan="4">
              <div>
                <b>{{ record.incidents|length }} incident{{ record.incidents|pluralize }}</b>
                <ul>
                  {% for incident in record.incidents %}
                    <li>
                      <em>{{ incident.alert_type.name }}</em> &mdash;
                      {{ incident.start_time }} -
                      {{ incident.end_time }}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </td>
          </tr>

        {% endfor %}
      </tbody>

    </table>

  {% endif %}

{% endblock %}
