{% extends 'business/report.html' %}


{% block report-content %}

  <h3>Availability</h3>

  <p>
    This report displays the IP Devices that has less than 100% availability in a given period.
  </p>

  <div>
    I want a report for
    <form id="report-form" class="inline-form">
      <select name="report-month">
        {% for month in months %}
          {{ start }}
          {{ month }}
          <option value="{{ month.year }}-{{ month.month }}"
                  {% if start == month %}selected{% endif %}
                  >
            {{ month|date:'F Y' }}
          </option>
        {% endfor %}
      </select>
      <input type="submit" class="button small" value="Fetch report">
    </form>
  </div>


  {% if records %}

    <table class="listtable">
      <caption>
        Availability report for {{ start|date:'F Y' }}
      </caption>
      <tr>
        <th>IP Device</th>
        <th>Incidents</th>
        <th>Downtime</th>
        <th>Availability</th>
      </tr>
      {% for record in records %}
        <tr>
          <td>{{ record.netbox|default_if_none:'<em>N/A</em>' }}</td>
          <td>{{ record.incidents|length }}</td>
          <td>{{ record.downtime }}</td>
          <td>{{ record.availability|floatformat:"-5" }}%</td>
        </tr>
        {% for incident in record.incidents %}
          <tr>
            <td colspan="4">
              {{ incident.alert_type.name }}
              {{ incident.start_time }} - 
              {{ incident.end_time }}
            </td>
          </tr>
        {% endfor %}
      {% endfor %}
    </table>

  {% endif %}

{% endblock %}
