{% extends "status2/base.html" %}

{% block base_header_additional_head %}
  <script type="text/javascript">require(['status/status']);</script>
  <script type="text/template" id="event_template">
    <li>
      <!-- Access template variables with <%= %> -->
      <%= event_type %>
    </li>
  </script>
{% endblock %}


{% block content %}
<p>This will eventually become the new status page</p>

  <div id="status-page">

    {# Form for filtering events #}
    <form id="status-panel" method="get" action="">

      <div class="row">
        {# alert-types #}
        <div class="small-4 columns">
          <label>
            Alert types
            <select name="alert_type" class="alert-dropdown select2" multiple="multiple">
              {% regroup alerttypes by event_type as event_types %}
              {% for event_type in event_types %}
                <optgroup label="{{ event_type.grouper }}">
                  {% for alert_type in event_type.list %}
                    <option value="{{ alert_type.name }}">{{ alert_type.name }}</option>
                  {% endfor %}
                </optgroup>
              {% endfor %}

            </select>
          </label>
        </div>  {# column #}

        <div class="small-4 columns">

        </div>  {# column #}


        <div class="small-4 columns">
        </div>  {# column #}
      </div>  {# row #}

    </form>

        {# Table displaying filtered events #}
        <table id="events-list" class="listtable">
          <caption>Events</caption>
          <thead>
            <tr>
              <td>Type</td>
              <td>Subject</td>
              <td>Start time</td>
              <td>&nbsp;</td>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

      </div>
    </div>

  </div>

{% if none %}
    <table class="listtable">
        <thead>
            <caption>Problems</caption>

            <th>Type</th>
            <th>Subject</th>
            <th>Start time</th>
            <th>Duration</th>

        </thead>

        <tfoot></tfoot>

        <tbody>
        {% for alert in alerts %}

            <tr>
                <td>
                    <span data-tooltip aria-haspopup="true" class="has-tip"
                          title="{{ alert.event_type.description }}">{{ alert.event_type_id }}</span>
                </td>

                <td>
                    {% comment %}
                    This may or may not fail spectacularly if subject has
                    not implemented the get_absolute_url() method
                    {% endcomment %}
                    {% if alert.get_subject.get_absolute_url %}
                        <a href="{{ alert.get_subject.get_absolute_url }}"
                                >{{ alert.get_subject }}</a>
                    {% else %}
                        {{ alert.get_subject }}
                    {% endif %}
                </td>

                <td>
                    <a href="{% url devicehistory-view %}?netbox={{ alert.netbox.id }}&amp;eventtype=a_{{ alert.alert_type.name }}&amp;group_by=datetime"
                            >{{ alert.start_time }}</a>
                </td>

                <td>
                    {% comment %}
                    May need to be defined differently if/when we need to
                    display stateless alerts
                    {% endcomment %}
                    {{ alert.start_time|timesince }}
                </td>

            </tr>
        {% endfor %}
        </tbody>

    </table>
{% endif %}

{% endblock %}
