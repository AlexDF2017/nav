{% extends "portadmin/base.html" %}
{% load portadmin %}

{% block base_header_title %}
PortAdmin - {{ netbox.get_short_sysname }}
{% endblock %}

{% block content %}

{% if interfaces %}

<div id="infoboxcontainer">

	{% if aliastemplate %}
	<div class="infobox">
		{{ aliastemplate }}
	</div>
	{% endif %}
	
	<div id="infobox" class="infobox">
		<h4>
            <img src="/images/icons/expand.png" class="toggler expand float-right" alt="Show available vlans" title="Show available vlans">
            <img src="/images/icons/collapse.png" class="toggler collapse float-right hidden" alt="Hide available vlans" title="Hide available vlans">
            Available vlans for {{ account.login }}@{{ netbox.get_short_sysname }}
        </h4>
		
		<ul class="hidden">
		{% for vlan in allowed_vlans %}
			<li>{{ vlan }}</li>
		{% endfor %}
		</ul>
	
	</div>
</div>

<div id="tablecontainer" class="text-right">
<table id="portadmin-interfacecontainer" class="vertitable">
	<caption><a href="/ipdevinfo/{{netbox.sysname}}">{{netbox.sysname}}</a><input type="button" class="saveall_button" value="Save all"/></caption>

    <thead>
    <tr>
        <th class="ifname">Port</th>
        <th class="text-center"
            title="AdminStatus - If red the interface is down">A
        </th>
        <th class="text-center"
            title="OperStatus - If red there is no link on the interface">O
        </th>
        <th class="ifalias">Port Description</th>
        <th class="vlan">Vlan</th>
        {% if voice_vlan %}
            <th class="voicevlan">Tel</th>
        {% endif %}
        <th class="button">&nbsp;</th>
    </tr>
    </thead>

    <tbody>
    {% for interface in interfaces %}
	<tr id="{{ interface.id }}">
		<td>{{ interface.ifname }}</td>

		<td class="text-center">
            <img title="AdminStatus - If red the interface is down" src="/images/lys/{{ interface.ifadminstatus|drawLight }}" />
        </td>

		<td class="text-center">
            <img title="OperStatus - If red there is no link on the interface" src="/images/lys/{{ interface.ifoperstatus|drawLight }}" />
        </td>

        <td>
            {% if interface.iseditable and not interface.trunk or interface.iseditable and interface.voice_activated %}
                <input class="ifalias" type="text"
                       value="{{ interface.ifalias|default_if_none:'' }}"
                       data-orig="{{ interface.ifalias|default_if_none:'' }}"/>
            {% else %}
                {{ interface.ifalias }}
            {% endif %}
        </td>

        {% comment %}
        If interface is a trunk, display link to trunk_edit if allowed
        If interface is not a trunk, display dropdown to choose vlan, or if
        not allowed to edit display access vlan
        {% endcomment %}
        <td>
			{% if interface.trunk and not interface.voice_activated %}
                {% if current_user_data.is_admin %}
                    <a href="{% url portadmin-render-trunk-edit interface.id %}">
                {% endif %}
			    Trunk
                {% if current_user_data.is_admin %}
                    </a>
                {% endif %}
            {% else %}
                {% if interface.iseditable %}
                    <select class="vlanlist" name="{{ interface.ifname }}">
                        {% for vlan in allowed_vlans %}
                            <option value="{{ vlan.vlan }}" {% if interface.vlan == vlan.vlan %}selected="selected" data-orig="{{ vlan.vlan }}"{% endif %}>
                                {{ vlan.vlan }}
                            </option>
                        {% endfor %}
                        {% if current_user_data.is_admin %}
                            <option value="trunk" data-url="{% url portadmin-render-trunk-edit interface.id %}">
                                Trunk
                            </option>
                        {% endif %}
                    </select>
                {% else %}
                    {{ interface.vlan|default_if_none:'' }}
                {% endif %}
            {% endif %}
		</td>


        {% comment %}
        If voice is activated the interface is a trunk. This need to check
        specifically for this.
        {% endcomment %}
        {% if voice_vlan %}
            {% if interface.voice_activated or not interface.trunk %}
                <td class="text-center">
                    <input class="voicevlan"
                           type="checkbox"
                           name="voice_vlan"
                           data-orig="{{ interface.voice_activated }}"
                           {% if interface.voice_activated %}checked{% endif %}
                           {% if not interface.iseditable %}disabled="disabled"{% endif %}>
                </td>
            {% endif %}
        {% endif %}


        {% comment %}
        These images serves as buttons for saving and undoing changes. They
        are initially hidden until a field is changed.
        {% endcomment %}
        <td>
			{% if interface.iseditable and not interface.trunk or interface.iseditable and interface.voice_activated %}
			<img src="/images/icons/edit-undo.png" class="undo" alt="Set as unchanged" title="Set as unchanged"/>
			<img src="/images/portadmin/save.png" class="save" alt="Save" title="Save"/>
			{% endif %}
		</td>
	</tr>
	{% endfor %}
    </tbody>

</table>

</div>

<input type="button" class="saveall_button" value="Save all"/>

{% endif %}

{% endblock %}

