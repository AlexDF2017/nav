===========================
 Release notes for NAV 3.3
===========================
Please report bugs at http://sourceforge.net/projects/nav

If you are upgrading from versions of NAV older than 3.2.2, please refer to the
release notes of the in-between versions before reading any further.

SNMP Trap daemon
================

NAV 3.3 features a new, plugin-based SNMP trap daemon.  The process is called
snmptrapd, and will start by default along with the rest ov NAV when the "nav
start" command is issued.

The trap daemon currently comes with two plugins, or traphandlers (sic) as the
snmptrapd calls them.  One handles LINKUP and LINKDOWN traps from equipment,
translating these into NAV linkState events.  The resulting linkUp/linkDown
alerts can be subscribed to through the Alert Profiles subsystem.  The second
plugin handles access point association/disassociation traps (sent when dumb
access points associate or disassociate with the controller, not when wireless
clients associate with access points) from a Cisco WLAN Controller, translating
these into NAV events which can also be subscribed to.

For further snmptrapd docs, see subsystem/snmptrapd/README .

Upgrading from NAV 3.3.2 and earlier
====================================

NAV 3.3.2 and earlier had some serious bugs in database triggers,
which would munge historic CAM and ARP data when IP devices or
prefixes were deleted.  To fix these bugs on upgrading to this
version, you *must* remember to run the SQL script
doc/sql/upgrade/3.3.0.sql (unless an automated package installer
already did this for you).  See doc/sql/README for more info on
running SQL scripts.

A bug in makecricketconfig would cause 32-bit traffic counters to be
used for some non-Cisco devices, such as Juniper routers and switches.
This would lead to serious errors in traffic graphs for interfaces
with traffic over 500Mbit/s on these devices.  The fixed
makecricketconfig in NAV 3.3.3 also requires you to add the following
three lines to the Defaults file in your top-level cricket
configuration directory:

targetType  subv2-interface
       ds      =       "ifHCInOctets, ifHCOutOctets"
       view    =       "Octets: ifHCInOctets ifHCOutOctets"


Upgrading from NAV 3.3.0
========================

A bug that was fixed in this version (SF#1812189 NAV says no cam table support
for many switches) caused NAV not to collect machine tracker data for many
Cisco switches.  getDeviceData needs to recreate the OID profile of all
switches to make sure they will have their cam tables collected.

To ensure that this happens, please run the snmpoid.sql script, located in
doc/sql/, again.  Although re-running snmpoid.sql is standard procedure on NAV
upgrades, we mention it explicitly here because of this serious bug.  See
doc/sql/README for more info on running SQL scripts.


Upgrading from NAV 3.2.2
========================

Database schema changes
-----------------------
NAV 3.3 makes various small changes to the database tables containing
historical machine tracker data.  Measurements show that updating the schema
with these changes will run about 33 times slower on PostgreSQL 7.4 than on
PostgreSQL 8.1.  No, this is not a typo, we literally mean _thirty-three_ times
slower.  The actual running time will vary with the number of records present
in the tables.

The provided upgrade script employs a schema change syntax that was first
introduced in PostgreSQL 8, and will consequently not work on a PostgreSQL 7.4
installation.  While more complex, 7.4-compatible syntax is provided in the
script comments, it is highly recommended to upgrade to PostgreSQL 8 before
upgrading NAV to version 3.3, as this minimizes the amount of downtime.

Although NAV 3.3 will most certainly run fine on PostgreSQL 7.4 after an
upgrade, it is likely that future NAV releases will use non-backwards
compatible PostgreSQL 8 syntax.  We therefore recommend upgrading as soon as
possible.


Changes to suggested initial privileges
---------------------------------------
A fresh installation of NAV 3.2.2 would suggest the following web_access
privilege for all authenticated users::

  ^/(report|status|messages|alertprofiles|machinetracker|browse|preferences|cricket)/?

NAV 3.3 suggests the following instead::

  ^/(report|status|alertprofiles|machinetracker|browse|preferences|cricket|navAdmin|stats|ipinfo|l2trace|logger)/?

The upgrade does not change this automatically, as it is your duty as NAV site
administrator to define access privileges in NAV as you see fit. These
suggested changes make sure every authenticated user has access to the ranked
statistics tool, the IP Info center, Layer 2 Traceroute tool and syslog
analyzer tool, in addition to the tools granted access to in previous versions.
Not everyone wants to permit this much access to any authenticated NAV user,
though.
