#!/usr/bin/env bash

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
localstatedir=@localstatedir@
sysconfdir=@sysconfdir@

NAV_CONF="${sysconfdir}/nav.conf"

if test -z "$JAVA_HOME"; then 
    JAVA_HOME=`awk -F= '/JAVA_HOME/ && $1!~/#.*/{gsub("[\t ]", "", $2); print $2}' $NAV_CONF`
fi

CUR_DIR=${bindir}/getDeviceData
LOG_DIR="${localstatedir}/log/getDeviceData"
PIDFILE=${localstatedir}/run/getDeviceData.pid

if test -f $PIDFILE; then
    pidnum=`cat $PIDFILE`
    if test -d /proc/$pidnum; then
	echo "getDeviceData already running!"
	exit 1
    fi
fi

cd $CUR_DIR
# Run script
$JAVA_HOME/bin/java -jar getDeviceData.jar $1 > "$LOG_DIR/getDeviceData-`/bin/date +%Y-%m-%d_%H-%M`.log" &
pidno="$!"
echo $pidno > $PIDFILE
