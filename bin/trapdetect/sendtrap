#!/usr/bin/perl -w
# Et lite sende-trap script brukt i testøyemed

use SNMP_util;

$ipadresse = "129.241.190.201";
$in = shift;
$type = shift;

if ($in =~ /syk/i) {
    &sendsyk;
} elsif ($in =~ /frisk/i) {
    &sendfrisk;
} else {
    print "Skjønner ikke input - sendtrap syk/frisk trap\n";
}

sub sendsyk {
    print "Sub sendsyk -> ";
    if ($type =~ /box/i) {
	print "box\n";
	$box = 1;
	$prefix = ".1.3.6.1.4.1.3001.1.1";
	$subprefix = ".1.3.6.1.4.1.3001.1.1.1";
    } elsif ($type =~ /snort/i) {
	$snort = 1;
	$prefix = ".1.3.6.1.4.1.3001.1.1";
	$subprefix = ".1.3.6.1.4.1.3001.1.2";
    } else {
	print "Ingen oid funnet\n";
	exit(0);
    }

    push(@data, "$subprefix.1", 'string', "862");
    push(@data, "$subprefix.2", 'string', "itea-nettel-230-h");
    push(@data, "$subprefix.3", 'string', "129.241.161.60");

    if ($box) {
	print "Sender trap\n";
	&snmptrap($ipadresse, $prefix, "bb", 6, 1, @data);
    } elsif ($snort) {
	&snmptrap($ipadresse, $prefix, "bb", 6, 1, @data);
    }
} 

sub sendfrisk {

    $box = 1;
    $prefix = ".1.3.6.1.4.1.3001.1.1.1";
    $subprefix = ".1.3.6.1.4.1.3001.2.1.1.1";

    push(@data, "$subprefix.1", 'string', "566");
    push(@data, "$subprefix.2", 'string', "testboxxx");
    push(@data, "$subprefix.3", 'string', "140977");

    &snmptrap($ipadresse, $prefix, "falcon", 6, 2, @data);
}


